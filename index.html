<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TourTick - Sistem Karcis Pariwisata</title>
    <!-- Load libraries from CDN -->
    <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/crypto-js@4.1.1/crypto-js.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #3498db;
            --secondary-color: #2980b9;
            --accent-color: #e74c3c;
            --light-color: #ecf0f1;
            --dark-color: #2c3e50;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f5f5;
            color: #333;
        }
        
        .sidebar {
            background-color: var(--dark-color);
            color: white;
            height: 100vh;
            position: fixed;
            transition: all 0.3s;
            overflow-y: auto;
        }
        
        .sidebar .nav-link {
            color: rgba(255, 255, 255, 0.8);
            border-radius: 5px;
            margin: 5px 0;
            transition: all 0.2s;
        }
        
        .sidebar .nav-link:hover {
            background-color: rgba(255, 255, 255, 0.1);
            color: white;
        }
        
        .sidebar .nav-link.active {
            background-color: var(--primary-color);
            color: white;
        }
        
        .main-content {
            margin-left: 250px;
            padding: 20px;
            transition: all 0.3s;
        }
        
        .card {
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
            border: none;
        }
        
        .card-header {
            background-color: var(--primary-color);
            color: white;
            border-radius: 10px 10px 0 0 !important;
            padding: 12px 20px;
        }
        
        .btn-primary {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
        }
        
        .btn-primary:hover {
            background-color: var(--secondary-color);
            border-color: var(--secondary-color);
        }
        
        .btn-danger {
            background-color: var(--accent-color);
            border-color: var(--accent-color);
        }
        
        .ticket {
            border: 2px dashed #ccc;
            padding: 15px;
            margin: 10px 0;
            background-color: white;
            border-radius: 10px;
        }
        
        .barcode-container {
            text-align: center;
            margin: 15px 0;
        }
        
        /* Responsive styles */
        @media (max-width: 992px) {
            .sidebar {
                width: 100%;
                height: auto;
                position: relative;
                padding: 10px;
            }
            .main-content {
                margin-left: 0;
                padding: 15px;
            }
        }
        
        @media (max-width: 768px) {
            .row > div {
                margin-bottom: 15px;
            }
            .d-flex.justify-content-between {
                flex-direction: column;
            }
            .d-flex.justify-content-between > * {
                margin-bottom: 10px;
            }
            .card-body {
                padding: 15px;
            }
        }
        
        .search-box {
            position: relative;
        }
        
        .search-box i {
            position: absolute;
            top: 10px;
            left: 10px;
            color: #aaa;
        }
        
        .search-box input {
            padding-left: 35px;
        }
        
        .ticket-preview {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--primary-color);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        
        /* Receipt styles */
        .receipt {
            width: 100%;
            max-width: 400px;
            margin: 0 auto;
            font-family: 'Courier New', monospace;
            padding: 15px;
            background-color: white;
        }
        
        .receipt .header {
            text-align: center;
            margin-bottom: 10px;
        }
        
        .receipt .divider {
            border-top: 1px dashed #000;
            margin: 10px 0;
        }
        
        .receipt .item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }
        
        .receipt .footer {
            text-align: center;
            margin-top: 15px;
            font-size: 0.9em;
        }
        
        .receipt-barcode {
            text-align: center;
            margin: 10px 0;
        }
        
        /* Permission settings */
        .permission-group {
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 10px;
            margin-bottom: 15px;
        }
        
        .permission-group h6 {
            border-bottom: 1px solid #eee;
            padding-bottom: 5px;
            margin-bottom: 10px;
        }
        
        .permission-item {
            margin-bottom: 8px;
        }
        
        /* Status badges */
        .badge-valid {
            background-color: #28a745;
        }
        
        .badge-used {
            background-color: #17a2b8;
        }
        
        .badge-expired {
            background-color: #dc3545;
        }
        
        /* Access denied */
        .access-denied {
            text-align: center;
            padding: 50px 20px;
        }
        
        .access-denied i {
            font-size: 80px;
            color: var(--accent-color);
            margin-bottom: 20px;
        }
        
        /* Loading spinner */
        .loading-spinner {
            display: inline-block;
            width: 2rem;
            height: 2rem;
            vertical-align: text-bottom;
            border: 0.25em solid currentColor;
            border-right-color: transparent;
            border-radius: 50%;
            animation: spinner-border .75s linear infinite;
        }
        
        @keyframes spinner-border {
            to { transform: rotate(360deg); }
        }

        /* Footer */
        .app-footer {
            background-color: var(--dark-color);
            color: white;
            padding: 15px;
            text-align: center;
            margin-top: 20px;
            border-radius: 5px;
        }

        .app-footer a {
            color: var(--light-color);
            text-decoration: none;
        }

        .app-footer a:hover {
            color: var(--primary-color);
        }

        /* Role permissions */
        .permission-checkbox {
            margin-right: 8px;
        }

        /* Backup section */
        .backup-card {
            cursor: pointer;
            transition: transform 0.2s;
        }

        .backup-card:hover {
            transform: translateY(-5px);
        }

        .backup-icon {
            font-size: 2.5rem;
            margin-bottom: 15px;
        }
    </style>
</head>
<body>
    <!-- Login Modal -->
    <div class="modal fade" id="loginModal" tabindex="-1" aria-hidden="false" data-bs-backdrop="static" data-bs-keyboard="false">
        <div class="modal-dialog login-modal">
            <div class="modal-content">
                <div class="modal-body p-4">
                    <div class="login-logo text-center">
                        <i class="fas fa-ticket-alt" style="font-size: 3rem; color: var(--primary-color);"></i>
                        <h3>TourTick</h3>
                        <p class="text-muted">Sistem Karcis Pariwisata</p>
                    </div>
                    <form id="loginForm">
                        <div class="mb-3">
                            <label class="form-label">Username</label>
                            <input type="text" class="form-control" id="loginUsername" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Password</label>
                            <input type="password" class="form-control" id="loginPassword" required>
                        </div>
                        <button type="submit" class="btn btn-primary w-100">
                            <i class="fas fa-sign-in-alt me-1"></i> Login
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Main App (hidden until login) -->
    <div id="appContainer" style="display: none;">
        <div class="d-flex flex-column flex-lg-row">
            <!-- Sidebar -->
            <div class="sidebar p-3" style="width: 250px;">
                <div class="text-center mb-4">
                    <h4>TourTick</h4>
                    <p class="text-muted">Sistem Karcis Pariwisata</p>
                </div>
                <hr>
                <ul class="nav flex-column">
                    <li class="nav-item">
                        <a class="nav-link active" href="#" onclick="showSection('dashboard')">
                            <i class="fas fa-home me-2"></i> Dashboard
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="showSection('ticket-sales')">
                            <i class="fas fa-ticket-alt me-2"></i> Penjualan Karcis
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="showSection('generate-ticket')">
                            <i class="fas fa-barcode me-2"></i> Generate Karcis
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="showSection('ticket-list')">
                            <i class="fas fa-list me-2"></i> Daftar Karcis
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="showSection('reports')">
                            <i class="fas fa-chart-bar me-2"></i> Laporan
                        </a>
                    </li>
                    <li class="nav-item" id="products-menu-item" style="display: none;">
                        <a class="nav-link" href="#" onclick="showSection('products')">
                            <i class="fas fa-map-marked-alt me-2"></i> Produk Wisata
                        </a>
                    </li>
                    <li class="nav-item" id="users-menu-item" style="display: none;">
                        <a class="nav-link" href="#" onclick="showSection('users')">
                            <i class="fas fa-users me-2"></i> Pengguna
                        </a>
                    </li>
                    <li class="nav-item" id="settings-menu-item" style="display: none;">
                        <a class="nav-link" href="#" onclick="showSection('settings')">
                            <i class="fas fa-cog me-2"></i> Pengaturan
                        </a>
                    </li>
                    <li class="nav-item" id="backup-menu-item">
                        <a class="nav-link" href="#" onclick="showSection('backup')">
                            <i class="fas fa-database me-2"></i> Backup Data
                        </a>
                    </li>
                </ul>
                <div class="mt-auto pt-3">
                    <div class="d-flex align-items-center">
                        <div class="user-avatar me-2" id="userAvatar">AD</div>
                        <div>
                            <small class="d-block" id="userName">Admin</small>
                            <small class="text-muted" id="userRole">Super User</small>
                        </div>
                    </div>
                    <button class="btn btn-sm btn-danger w-100 mt-3" onclick="logout()">
                        <i class="fas fa-sign-out-alt me-1"></i> Logout
                    </button>
                </div>
            </div>

            <!-- Main Content -->
            <div class="main-content">
                <!-- Dashboard Section -->
                <div id="dashboard-section">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h3>Dashboard</h3>
                        <div class="d-flex">
                            <div class="search-box me-2">
                                <i class="fas fa-search"></i>
                                <input type="text" class="form-control" placeholder="Cari...">
                            </div>
                            <button class="btn btn-primary" onclick="refreshDashboard()">
                                <i class="fas fa-sync-alt me-1"></i> Refresh
                            </button>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-3">
                            <div class="card">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div>
                                            <h6 class="text-muted">Penjualan Hari Ini</h6>
                                            <h3 id="todaySales">0</h3>
                                            <span class="text-success"><i class="fas fa-arrow-up me-1"></i> 0%</span>
                                        </div>
                                        <div class="bg-primary bg-opacity-10 p-3 rounded">
                                            <i class="fas fa-shopping-cart text-primary"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div>
                                            <h6 class="text-muted">Pendapatan Hari Ini</h6>
                                            <h3 id="todayRevenue">Rp0</h3>
                                            <span class="text-success"><i class="fas fa-arrow-up me-1"></i> 0%</span>
                                        </div>
                                        <div class="bg-success bg-opacity-10 p-3 rounded">
                                            <i class="fas fa-wallet text-success"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div>
                                            <h6 class="text-muted">Pengunjung Hari Ini</h6>
                                            <h3 id="todayVisitors">0</h3>
                                            <span class="text-danger"><i class="fas fa-arrow-down me-1"></i> 0%</span>
                                        </div>
                                        <div class="bg-info bg-opacity-10 p-3 rounded">
                                            <i class="fas fa-users text-info"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div>
                                            <h6 class="text-muted">Karcis Tersedia</h6>
                                            <h3 id="availableTickets">0</h3>
                                            <span class="text-warning"><i class="fas fa-exclamation-circle me-1"></i> Low</span>
                                        </div>
                                        <div class="bg-warning bg-opacity-10 p-3 rounded">
                                            <i class="fas fa-ticket-alt text-warning"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row mt-4">
                        <div class="col-md-8">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="card-title mb-0">Statistik Penjualan 7 Hari Terakhir</h5>
                                </div>
                                <div class="card-body">
                                    <canvas id="salesChart" height="250"></canvas>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="card-title mb-0">Produk Terlaris</h5>
                                </div>
                                <div class="card-body">
                                    <canvas id="topProductsChart" height="250"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row mt-4">
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="card-title mb-0">Transaksi Terakhir</h5>
                                </div>
                                <div class="card-body p-0">
                                    <div class="table-responsive">
                                        <table class="table table-hover mb-0">
                                            <thead>
                                                <tr>
                                                    <th>ID</th>
                                                    <th>Tanggal</th>
                                                    <th>Jumlah</th>
                                                    <th>Total</th>
                                                </tr>
                                            </thead>
                                            <tbody id="recentTransactions">
                                                <!-- Transactions will be loaded here -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="card-title mb-0">Aktivitas Terkini</h5>
                                </div>
                                <div class="card-body p-0">
                                    <div class="list-group list-group-flush" id="recentActivities">
                                        <!-- Activities will be loaded here -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Ticket Sales Section -->
                <div id="ticket-sales-section" style="display: none;">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h3>Penjualan Karcis</h3>
                        <div>
                            <button class="btn btn-primary me-2" onclick="printTicket()">
                                <i class="fas fa-print me-1"></i> Cetak
                            </button>
                            <button class="btn btn-success" onclick="completeTransaction()">
                                <i class="fas fa-check me-1"></i> Selesaikan Transaksi
                            </button>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-lg-8">
                            <div class="card">
                                <div class="card-header">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <h5 class="card-title mb-0">Karcis Tersedia</h5>
                                        <div class="search-box">
                                            <i class="fas fa-search"></i>
                                            <input type="text" class="form-control form-control-sm" placeholder="Cari karcis..." id="ticketSearchSales" onkeyup="searchTicketsSales()">
                                        </div>
                                    </div>
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-hover">
                                            <thead>
                                                <tr>
                                                    <th>Kode</th>
                                                    <th>Destinasi</th>
                                                    <th>Jenis</th>
                                                    <th>Harga</th>
                                                    <th>Tanggal Berlaku</th>
                                                    <th>Aksi</th>
                                                </tr>
                                            </thead>
                                            <tbody id="availableTicketsTable">
                                                <!-- Available tickets will be loaded here -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>

                            <div class="card mt-4">
                                <div class="card-header">
                                    <h5 class="card-title mb-0">Preview Karcis</h5>
                                </div>
                                <div class="card-body">
                                    <div class="ticket-preview text-center" id="ticketPreviewContent">
                                        <h4>Taman Wisata Alam</h4>
                                        <p>Jl. Raya Wisata No. 123, Kota Pariwisata</p>
                                        <hr>
                                        <div class="barcode-container">
                                            <svg id="barcode-preview"></svg>
                                        </div>
                                        <div class="d-flex justify-content-between">
                                            <div class="text-start">
                                                <small class="text-muted">Kode Karcis</small>
                                                <p class="mb-0 fw-bold">TWA-001</p>
                                            </div>
                                            <div class="text-end">
                                                <small class="text-muted">Tanggal</small>
                                                <p class="mb-0 fw-bold">10 Jun 2023</p>
                                            </div>
                                        </div>
                                        <hr>
                                        <div class="d-flex justify-content-between">
                                            <div class="text-start">
                                                <small class="text-muted">Harga</small>
                                                <p class="mb-0 fw-bold">Rp50.000</p>
                                            </div>
                                            <div class="text-end">
                                                <small class="text-muted">Status</small>
                                                <p class="mb-0 fw-bold text-success">Valid</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-lg-4">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="card-title mb-0">Keranjang Belanja</h5>
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-sm">
                                            <thead>
                                                <tr>
                                                    <th>Karcis</th>
                                                    <th>Harga</th>
                                                    <th></th>
                                                </tr>
                                            </thead>
                                            <tbody id="cartItems">
                                                <!-- Cart items will be loaded here -->
                                            </tbody>
                                        </table>
                                    </div>
                                    <hr>
                                    <div class="d-flex justify-content-between mb-3 fw-bold">
                                        <span>Total:</span>
                                        <span id="total">Rp0</span>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Pembayaran</label>
                                        <select class="form-select" id="paymentMethod" onchange="updatePaymentMethod()">
                                            <option value="cash">Tunai</option>
                                            <option value="transfer">Transfer Bank</option>
                                            <option value="qris">QRIS</option>
                                            <option value="debit">Kartu Debit</option>
                                        </select>
                                    </div>
                                    <div class="mb-3" id="cashInputContainer">
                                        <label class="form-label">Uang Diterima</label>
                                        <input type="number" class="form-control" id="cashReceived" min="0" value="0" oninput="updateChangeAmount()">
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Kembalian</label>
                                        <input type="text" class="form-control" id="changeAmount" readonly value="Rp0">
                                    </div>
                                    <button class="btn btn-danger w-100 mb-2" onclick="clearCart()">
                                        <i class="fas fa-trash me-1"></i> Kosongkan Keranjang
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Generate Ticket Section -->
                <div id="generate-ticket-section" style="display: none;">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h3>Generate Karcis</h3>
                        <div>
                            <button class="btn btn-primary me-2" onclick="generateBarcode()">
                                <i class="fas fa-barcode me-1"></i> Generate Barcode
                            </button>
                            <button class="btn btn-success" onclick="printGeneratedTicket()">
                                <i class="fas fa-print me-1"></i> Cetak Karcis
                            </button>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="card-title mb-0">Form Karcis</h5>
                                </div>
                                <div class="card-body">
                                    <form id="ticketForm">
                                        <div class="mb-3">
                                            <label class="form-label">Jenis Karcis</label>
                                            <select class="form-select" id="ticketType" required onchange="updateTicketCode()">
                                                <option value="">Pilih Jenis Karcis</option>
                                                <option value="regular">Reguler</option>
                                                <option value="vip">VIP</option>
                                                <option value="group">Grup</option>
                                                <option value="student">Pelajar/Mahasiswa</option>
                                                <option value="foreigner">Warga Asing</option>
                                            </select>
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">Destinasi Wisata</label>
                                            <select class="form-select" id="destination" required onchange="updateDestinationDetails()">
                                                <option value="">Pilih Destinasi</option>
                                                <!-- Options will be loaded from products -->
                                            </select>
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">Harga</label>
                                            <input type="number" class="form-control" id="ticketPrice" required>
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">Jumlah Karcis</label>
                                            <input type="number" class="form-control" id="ticketQuantity" min="1" value="1" required>
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">Tanggal Berlaku</label>
                                            <input type="date" class="form-control" id="validDate" required>
                                        </div>
                                        <div class="mb-3 form-check">
                                            <input type="checkbox" class="form-check-input" id="includeTax">
                                            <label class="form-check-label" for="includeTax">Termasuk Pajak</label>
                                        </div>
                                        <button type="submit" class="btn btn-primary w-100" onclick="saveTicket(event)">
                                            <i class="fas fa-save me-1"></i> Simpan Karcis
                                        </button>
                                    </form>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="card-title mb-0">Preview Karcis</h5>
                                </div>
                                <div class="card-body">
                                    <div class="ticket-preview text-center" id="ticketPreview">
                                        <h4 id="previewDestination">Taman Wisata Alam</h4>
                                        <p id="previewAddress">Jl. Raya Wisata No. 123, Kota Pariwisata</p>
                                        <hr>
                                        <div class="barcode-container">
                                            <svg id="barcode"></svg>
                                        </div>
                                        <div class="d-flex justify-content-between">
                                            <div class="text-start">
                                                <small class="text-muted">Jenis</small>
                                                <p class="mb-0 fw-bold" id="previewType">Reguler</p>
                                            </div>
                                            <div class="text-end">
                                                <small class="text-muted">Kode</small>
                                                <p class="mb-0 fw-bold" id="previewCode">TWA-001</p>
                                            </div>
                                        </div>
                                        <hr>
                                        <div class="d-flex justify-content-between">
                                            <div class="text-start">
                                                <small class="text-muted">Tanggal</small>
                                                <p class="mb-0 fw-bold" id="previewDate">10 Jun 2023</p>
                                            </div>
                                            <div class="text-end">
                                                <small class="text-muted">Harga</small>
                                                <p class="mb-0 fw-bold" id="previewPrice">Rp50.000</p>
                                            </div>
                                        </div>
                                        <div class="mt-3">
                                            <small class="text-muted">Status</small>
                                            <p class="mb-0 fw-bold text-success" id="previewStatus">Belum Digunakan</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Ticket List Section -->
                <div id="ticket-list-section" style="display: none;">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h3>Daftar Karcis</h3>
                        <div>
                            <button class="btn btn-primary me-2" onclick="exportTickets()">
                                <i class="fas fa-file-export me-1"></i> Export
                            </button>
                            <button class="btn btn-success" onclick="showImportModal()">
                                <i class="fas fa-file-import me-1"></i> Import
                            </button>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <div class="d-flex justify-content-between align-items-center">
                                <h5 class="card-title mb-0">Daftar Karcis</h5>
                                <div class="d-flex">
                                    <div class="search-box me-2">
                                        <i class="fas fa-search"></i>
                                        <input type="text" class="form-control form-control-sm" placeholder="Cari karcis..." id="ticketSearch" onkeyup="searchTickets()">
                                    </div>
                                    <select class="form-select form-select-sm" style="width: 150px;" id="ticketFilter" onchange="filterTickets()">
                                        <option value="all">Semua Status</option>
                                        <option value="valid">Valid</option>
                                        <option value="used">Digunakan</option>
                                        <option value="expired">Kadaluarsa</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead>
                                        <tr>
                                            <th>Kode</th>
                                            <th>Destinasi</th>
                                            <th>Jenis</th>
                                            <th>Harga</th>
                                            <th>Tanggal</th>
                                            <th>Status</th>
                                            <th>Aksi</th>
                                        </tr>
                                    </thead>
                                    <tbody id="ticketTableBody">
                                        <!-- Tickets will be loaded here -->
                                    </tbody>
                                </table>
                            </div>
                            <nav aria-label="Page navigation" class="mt-3">
                                <ul class="pagination justify-content-center">
                                    <li class="page-item disabled">
                                        <a class="page-link" href="#" tabindex="-1">Previous</a>
                                    </li>
                                    <li class="page-item active"><a class="page-link" href="#">1</a></li>
                                    <li class="page-item"><a class="page-link" href="#">2</a></li>
                                    <li class="page-item"><a class="page-link" href="#">3</a></li>
                                    <li class="page-item">
                                        <a class="page-link" href="#">Next</a>
                                    </li>
                                </ul>
                            </nav>
                        </div>
                    </div>
                </div>

                <!-- Reports Section -->
                <div id="reports-section" style="display: none;">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h3>Laporan</h3>
                        <div>
                            <button class="btn btn-primary me-2" onclick="generateDailyReport()">
                                <i class="fas fa-file-pdf me-1"></i> Cetak Laporan
                            </button>
                            <button class="btn btn-success" onclick="exportReportData()">
                                <i class="fas fa-file-excel me-1"></i> Export Data
                            </button>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h5 class="card-title mb-0">Filter Laporan</h5>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-3">
                                    <div class="mb-3">
                                        <label class="form-label">Tanggal Mulai</label>
                                        <input type="date" class="form-control" id="reportStartDate">
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="mb-3">
                                        <label class="form-label">Tanggal Akhir</label>
                                        <input type="date" class="form-control" id="reportEndDate">
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="mb-3">
                                        <label class="form-label">Jenis Karcis</label>
                                        <select class="form-select" id="reportTicketType">
                                            <option value="all">Semua Jenis</option>
                                            <option value="regular">Reguler</option>
                                            <option value="vip">VIP</option>
                                            <option value="group">Grup</option>
                                            <option value="student">Pelajar/Mahasiswa</option>
                                            <option value="foreigner">Warga Asing</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="mb-3">
                                        <label class="form-label">Destinasi</label>
                                        <select class="form-select" id="reportDestination">
                                            <option value="all">Semua Destinasi</option>
                                            <!-- Options will be loaded from products -->
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <button class="btn btn-primary" onclick="loadReportData()">
                                <i class="fas fa-filter me-1"></i> Filter Data
                            </button>
                        </div>
                    </div>

                    <div class="card mt-4">
                        <div class="card-header">
                            <h5 class="card-title mb-0">Statistik Penjualan</h5>
                        </div>
                        <div class="card-body">
                            <canvas id="reportChart" height="300"></canvas>
                        </div>
                    </div>

                    <div class="card mt-4">
                        <div class="card-header">
                            <h5 class="card-title mb-0">Detail Transaksi</h5>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead>
                                        <tr>
                                            <th>ID Transaksi</th>
                                            <th>Tanggal</th>
                                            <th>Karcis</th>
                                            <th>Jumlah</th>
                                            <th>Harga</th>
                                            <th>Total</th>
                                            <th>Kasir</th>
                                        </tr>
                                    </thead>
                                    <tbody id="reportTableBody">
                                        <!-- Report data will be loaded here -->
                                    </tbody>
                                </table>
                            </div>
                            <nav aria-label="Page navigation" class="mt-3">
                                <ul class="pagination justify-content-center">
                                    <li class="page-item disabled">
                                        <a class="page-link" href="#" tabindex="-1">Previous</a>
                                    </li>
                                    <li class="page-item active"><a class="page-link" href="#">1</a></li>
                                    <li class="page-item"><a class="page-link" href="#">2</a></li>
                                    <li class="page-item"><a class="page-link" href="#">3</a></li>
                                    <li class="page-item">
                                        <a class="page-link" href="#">Next</a>
                                    </li>
                                </ul>
                            </nav>
                        </div>
                    </div>
                </div>

               <!-- Products Section -->
                <div id="products-section" style="display: none;">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h3>Produk Wisata</h3>
                        <button class="btn btn-primary" onclick="showAddProductModal()">
                            <i class="fas fa-plus me-1"></i> Tambah Produk
                        </button>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <div class="d-flex justify-content-between align-items-center">
                                <h5 class="card-title mb-0">Daftar Produk Wisata</h5>
                                <div class="search-box">
                                    <i class="fas fa-search"></i>
                                    <input type="text" class="form-control form-control-sm" placeholder="Cari produk..." id="productSearch" onkeyup="searchProducts()">
                                </div>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead>
                                        <tr>
                                            <th>Kode</th>
                                            <th>Nama</th>
                                            <th>Lokasi</th>
                                            <th>Harga Reguler</th>
                                            <th>Status</th>
                                            <th>Aksi</th>
                                        </tr>
                                    </thead>
                                    <tbody id="productTableBody">
                                        <!-- Products will be loaded here -->
                                    </tbody>
                                </table>
                            </div>
                            <nav aria-label="Page navigation" class="mt-3">
                                <ul class="pagination justify-content-center">
                                    <li class="page-item disabled">
                                        <a class="page-link" href="#" tabindex="-1">Previous</a>
                                    </li>
                                    <li class="page-item active"><a class="page-link" href="#">1</a></li>
                                    <li class="page-item"><a class="page-link" href="#">2</a></li>
                                    <li class="page-item"><a class="page-link" href="#">3</a></li>
                                    <li class="page-item">
                                        <a class="page-link" href="#">Next</a>
                                    </li>
                                </ul>
                            </nav>
                        </div>
                    </div>
                </div>

                <!-- Users Section -->
                <div id="users-section" style="display: none;">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h3>Manajemen Pengguna</h3>
                        <button class="btn btn-primary" onclick="showAddUserModal()">
                            <i class="fas fa-plus me-1"></i> Tambah Pengguna
                        </button>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <div class="d-flex justify-content-between align-items-center">
                                <h5 class="card-title mb-0">Daftar Pengguna</h5>
                                <div class="search-box">
                                    <i class="fas fa-search"></i>
                                    <input type="text" class="form-control form-control-sm" placeholder="Cari pengguna..." id="userSearch" onkeyup="searchUsers()">
                                </div>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead>
                                        <tr>
                                            <th>Nama</th>
                                            <th>Username</th>
                                            <th>Role</th>
                                            <th>Status</th>
                                            <th>Terakhir Login</th>
                                            <th>Aksi</th>
                                        </tr>
                                    </thead>
                                    <tbody id="userTableBody">
                                        <!-- Users will be loaded here -->
                                    </tbody>
                                </table>
                            </div>
                            <nav aria-label="Page navigation" class="mt-3">
                                <ul class="pagination justify-content-center">
                                    <li class="page-item disabled">
                                        <a class="page-link" href="#" tabindex="-1">Previous</a>
                                    </li>
                                    <li class="page-item active"><a class="page-link" href="#">1</a></li>
                                    <li class="page-item"><a class="page-link" href="#">2</a></li>
                                    <li class="page-item"><a class="page-link" href="#">3</a></li>
                                    <li class="page-item">
                                        <a class="page-link" href="#">Next</a>
                                    </li>
                                </ul>
                            </nav>
                        </div>
                    </div>
                </div>

                <!-- Settings Section -->
                <div id="settings-section" style="display: none;">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h3>Pengaturan Sistem</h3>
                        <button class="btn btn-primary" onclick="saveSettings()">
                            <i class="fas fa-save me-1"></i> Simpan Pengaturan
                        </button>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="card-title mb-0">Pengaturan Umum</h5>
                                </div>
                                <div class="card-body">
                                    <form id="generalSettingsForm">
                                        <div class="mb-3">
                                            <label class="form-label">Nama Aplikasi</label>
                                            <input type="text" class="form-control" id="appName" value="TourTick">
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">Logo Aplikasi</label>
                                            <input type="file" class="form-control" id="appLogo">
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">Timezone</label>
                                            <select class="form-select" id="timezone">
                                                <option value="Asia/Jakarta">WIB (Asia/Jakarta)</option>
                                                <option value="Asia/Makassar">WITA (Asia/Makassar)</option>
                                                <option value="Asia/Jayapura">WIT (Asia/Jayapura)</option>
                                            </select>
                                        </div>
                                        <div class="mb-3 form-check">
                                            <input type="checkbox" class="form-check-input" id="enableTax">
                                            <label class="form-check-label" for="enableTax">Aktifkan Pajak</label>
                                        </div>
                                        <div class="mb-3" id="taxRateContainer" style="display: none;">
                                            <label class="form-label">Persentase Pajak (%)</label>
                                            <input type="number" class="form-control" id="taxRate" value="10" min="0" max="100">
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="card-title mb-0">Pengaturan Cetak</h5>
                                </div>
                                <div class="card-body">
                                    <form id="printSettingsForm">
                                        <div class="mb-3">
                                            <label class="form-label">Header Struk</label>
                                            <textarea class="form-control" id="receiptHeader" rows="2">Terima kasih telah berkunjung</textarea>
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">Footer Struk</label>
                                            <textarea class="form-control" id="receiptFooter" rows="2">Barang yang sudah dibeli tidak dapat dikembalikan</textarea>
                                        </div>
                                        <div class="mb-3 form-check">
                                            <input type="checkbox" class="form-check-input" id="printLogo">
                                            <label class="form-check-label" for="printLogo">Cetak Logo pada Struk</label>
                                        </div>
                                        <div class="mb-3 form-check">
                                            <input type="checkbox" class="form-check-input" id="printAddress">
                                            <label class="form-check-label" for="printAddress">Cetak Alamat pada Struk</label>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card mt-4">
                        <div class="card-header">
                            <h5 class="card-title mb-0">Preview Struk</h5>
                        </div>
                        <div class="card-body">
                            <div class="receipt" id="receiptPreview">
                                <div class="header">
                                    <h5 id="previewReceiptTitle">TourTick</h5>
                                    <small id="previewReceiptAddress">Jl. Raya Wisata No. 123, Kota Pariwisata</small>
                                </div>
                                <div class="divider"></div>
                                <div class="item">
                                    <span>Karcis Reguler</span>
                                    <span>Rp50.000</span>
                                </div>
                                <div class="item">
                                    <span>Karcis Pelajar</span>
                                    <span>Rp30.000</span>
                                </div>
                                <div class="divider"></div>
                                <div class="item">
                                    <span>Subtotal</span>
                                    <span>Rp80.000</span>
                                </div>
                                <div class="item">
                                    <span>Pajak (10%)</span>
                                    <span>Rp8.000</span>
                                </div>
                                <div class="item fw-bold">
                                    <span>Total</span>
                                    <span>Rp88.000</span>
                                </div>
                                <div class="divider"></div>
                                <div class="receipt-barcode">
                                    <svg id="receiptBarcode"></svg>
                                </div>
                                <div class="footer">
                                    <p id="previewReceiptFooter">Terima kasih telah berkunjung</p>
                                    <small>12 Jun 2023 14:30:45</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Backup Section -->
                <div id="backup-section" style="display: none;">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h3>Backup & Restore Data</h3>
                        <div id="adminBackupButtons" style="display: none;">
                            <button class="btn btn-danger me-2" onclick="showResetConfirmation()">
                                <i class="fas fa-trash-restore me-1"></i> Reset Data
                            </button>
                            <button class="btn btn-warning me-2" onclick="showRestoreModal()">
                                <i class="fas fa-upload me-1"></i> Restore Data
                            </button>
                            <button class="btn btn-primary" onclick="backupData()">
                                <i class="fas fa-download me-1"></i> Backup Data
                            </button>
                        </div>
                        <div id="nonAdminBackupButtons">
                            <button class="btn btn-primary" onclick="backupData()">
                                <i class="fas fa-download me-1"></i> Backup Data
                            </button>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-4">
                            <div class="card backup-card text-center p-4" onclick="backupData()">
                                <i class="fas fa-download backup-icon text-primary"></i>
                                <h5>Backup Data</h5>
                                <p class="text-muted">Simpan semua data ke file JSON</p>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card backup-card text-center p-4" onclick="showRestoreModal()" id="restoreCard">
                                <i class="fas fa-upload backup-icon text-warning"></i>
                                <h5>Restore Data</h5>
                                <p class="text-muted">Muat data dari file backup</p>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card backup-card text-center p-4" onclick="showResetConfirmation()" id="resetCard">
                                <i class="fas fa-trash-restore backup-icon text-danger"></i>
                                <h5>Reset Data</h5>
                                <p class="text-muted">Kembalikan ke data awal</p>
                            </div>
                        </div>
                    </div>

                    <div class="card mt-4">
                        <div class="card-header">
                            <h5 class="card-title mb-0">Riwayat Backup</h5>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead>
                                        <tr>
                                            <th>Tanggal</th>
                                            <th>Jenis</th>
                                            <th>Ukuran</th>
                                            <th>Oleh</th>
                                            <th>Aksi</th>
                                        </tr>
                                    </thead>
                                    <tbody id="backupHistoryTable">
                                        <!-- Backup history will be loaded here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <div class="app-footer mt-4">
                        <p>&copy; 2025 Lentera Karya Situbondo. All rights reserved.</p>
                        <p>
                            <a href="https://www.anekamarket.my.id" target="_blank">www.anekamarket.my.id</a> | 
                            <a href="mailto:admin@anekamarket.my.id">admin@anekamarket.my.id</a>
                        </p>
                    </div>
                </div>

                <!-- Access Denied Section -->
                <div id="access-denied-section" style="display: none;">
                    <div class="access-denied">
                        <i class="fas fa-ban"></i>
                        <h3>Akses Ditolak</h3>
                        <p>Anda tidak memiliki izin untuk mengakses halaman ini.</p>
                        <button class="btn btn-primary" onclick="showSection('dashboard')">
                            <i class="fas fa-home me-1"></i> Kembali ke Dashboard
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Product Modal -->
    <div class="modal fade" id="addProductModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Tambah Produk Wisata</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="addProductForm">
                        <div class="mb-3">
                            <label class="form-label">Kode Produk</label>
                            <input type="text" class="form-control" id="productCode" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Nama Produk</label>
                            <input type="text" class="form-control" id="productName" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Lokasi</label>
                            <textarea class="form-control" id="productLocation" rows="2" required></textarea>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Deskripsi</label>
                            <textarea class="form-control" id="productDescription" rows="3"></textarea>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Harga Reguler</label>
                                    <input type="number" class="form-control" id="productRegularPrice" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Harga VIP</label>
                                    <input type="number" class="form-control" id="productVipPrice">
                                </div>
                            </div>
                        </div>
                        <div class="mb-3 form-check">
                            <input type="checkbox" class="form-check-input" id="productStatus" checked>
                            <label class="form-check-label" for="productStatus">Aktif</label>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
                    <button type="button" class="btn btn-primary" onclick="saveProduct()">Simpan</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add User Modal -->
    <div class="modal fade" id="addUserModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Tambah Pengguna</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="addUserForm">
                        <div class="mb-3">
                            <label class="form-label">Nama Lengkap</label>
                            <input type="text" class="form-control" id="userFullName" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Username</label>
                            <input type="text" class="form-control" id="userUsername" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Password</label>
                            <input type="password" class="form-control" id="userPassword" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Role</label>
                            <select class="form-select" id="userRole" required>
                                <option value="admin">Admin</option>
                                <option value="cashier">Kasir</option>
                                <option value="operator">Operator</option>
                                <option value="manager">Manager</option>
                            </select>
                        </div>
                        <div class="mb-3 form-check">
                            <input type="checkbox" class="form-check-input" id="userStatus" checked>
                            <label class="form-check-label" for="userStatus">Aktif</label>
                        </div>
                        <div class="permission-group" id="permissionSettings">
                            <h6>Hak Akses</h6>
                            <!-- Permissions will be loaded here -->
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
                    <button type="button" class="btn btn-primary" onclick="saveUser()">Simpan</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Import Tickets Modal -->
    <div class="modal fade" id="importTicketsModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Import Karcis</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label">Pilih File Excel (.xlsx)</label>
                        <input type="file" class="form-control" id="ticketImportFile" accept=".xlsx">
                    </div>
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle me-2"></i>
                        Pastikan format file sesuai dengan template yang disediakan.
                        <a href="#" onclick="downloadImportTemplate()">Download template</a>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
                    <button type="button" class="btn btn-primary" onclick="importTickets()">Import</button>
                </div>
            </div>
        </div>
    </div>

    <!-- View Ticket Modal -->
    <div class="modal fade" id="viewTicketModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Detail Karcis</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="ticket-preview text-center">
                        <h4 id="viewTicketDestination">Taman Wisata Alam</h4>
                        <p id="viewTicketAddress">Jl. Raya Wisata No. 123, Kota Pariwisata</p>
                        <hr>
                        <div class="barcode-container">
                            <svg id="viewTicketBarcode"></svg>
                        </div>
                        <div class="d-flex justify-content-between">
                            <div class="text-start">
                                <small class="text-muted">Jenis</small>
                                <p class="mb-0 fw-bold" id="viewTicketType">Reguler</p>
                            </div>
                            <div class="text-end">
                                <small class="text-muted">Kode</small>
                                <p class="mb-0 fw-bold" id="viewTicketCode">TWA-001</p>
                            </div>
                        </div>
                        <hr>
                        <div class="d-flex justify-content-between">
                            <div class="text-start">
                                <small class="text-muted">Tanggal</small>
                                <p class="mb-0 fw-bold" id="viewTicketDate">10 Jun 2023</p>
                            </div>
                            <div class="text-end">
                                <small class="text-muted">Harga</small>
                                <p class="mb-0 fw-bold" id="viewTicketPrice">Rp50.000</p>
                            </div>
                        </div>
                        <div class="mt-3">
                            <small class="text-muted">Status</small>
                            <p class="mb-0 fw-bold text-success" id="viewTicketStatus">Belum Digunakan</p>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Tutup</button>
                    <button type="button" class="btn btn-primary" onclick="printSingleTicket()">
                        <i class="fas fa-print me-1"></i> Cetak
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Restore Data Modal -->
    <div class="modal fade" id="restoreModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Restore Data</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label">Pilih File Backup (.json)</label>
                        <input type="file" class="form-control" id="restoreFile" accept=".json">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Password Admin</label>
                        <input type="password" class="form-control" id="adminPassword" placeholder="Masukkan password admin">
                    </div>
                    <div class="alert alert-warning">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        <strong>Peringatan!</strong> Restore data akan menggantikan semua data saat ini dengan data dari file backup.
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
                    <button type="button" class="btn btn-primary" onclick="restoreData()">Restore Data</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Reset Confirmation Modal -->
    <div class="modal fade" id="resetConfirmationModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Konfirmasi Reset Data</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label">Password Admin</label>
                        <input type="password" class="form-control" id="resetAdminPassword" placeholder="Masukkan password admin">
                    </div>
                    <div class="alert alert-danger">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        <strong>Peringatan!</strong> Ini akan menghapus semua data dan mengembalikan ke pengaturan awal. Tindakan ini tidak dapat dibatalkan!
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
                    <button type="button" class="btn btn-danger" onclick="resetData()">Reset Data</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading Modal -->
    <div class="modal fade" id="loadingModal" tabindex="-1" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content border-0 bg-transparent">
                <div class="modal-body text-center">
                    <div class="loading-spinner text-primary" style="width: 3rem; height: 3rem;"></div>
                    <p class="mt-3">Memproses...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Custom JavaScript -->
    <script>
        // Global variables
        let currentUser = null;
        let tickets = [];
        let products = [];
        let users = [];
        let transactions = [];
        let cart = [];
        let backupHistory = [];
        let rolePermissions = {
            admin: {
                dashboard: true,
                ticketSales: true,
                generateTicket: true,
                ticketList: true,
                reports: true,
                products: true,
                users: true,
                settings: true,
                backup: true,
                restore: true,
                reset: true
            },
            manager: {
                dashboard: true,
                ticketSales: true,
                generateTicket: true,
                ticketList: true,
                reports: true,
                products: true,
                users: false,
                settings: true,
                backup: true,
                restore: false,
                reset: false
            },
            cashier: {
                dashboard: true,
                ticketSales: true,
                generateTicket: false,
                ticketList: true,
                reports: false,
                products: false,
                users: false,
                settings: false,
                backup: true,
                restore: false,
                reset: false
            },
            operator: {
                dashboard: true,
                ticketSales: false,
                generateTicket: true,
                ticketList: true,
                reports: false,
                products: true,
                users: false,
                settings: false,
                backup: true,
                restore: false,
                reset: false
            }
        };
        
        // Initialize the application when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize modals
            const loginModal = new bootstrap.Modal(document.getElementById('loginModal'), {backdrop: 'static'});
            loginModal.show();
            
            // Set today's date as default for ticket validity
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('validDate').value = today;
            
            // Load sample data (in a real app, this would be from an API)
            loadSampleData();
            
            // Set up event listeners
            document.getElementById('loginForm').addEventListener('submit', handleLogin);
            document.getElementById('enableTax').addEventListener('change', function() {
                document.getElementById('taxRateContainer').style.display = this.checked ? 'block' : 'none';
            });
            
            // Generate initial barcode
            updateTicketCode();
        });
        
        // Sample data loading (for demo purposes)
        function loadSampleData() {
            // Sample products
            products = [
                {code: 'TWA', name: 'Taman Wisata Alam', location: 'Jl. Raya Wisata No. 123', regularPrice: 50000, vipPrice: 75000, status: 'active'},
                {code: 'MB', name: 'Museum Bahari', location: 'Jl. Pasar Ikan No. 1', regularPrice: 30000, vipPrice: 50000, status: 'active'},
                {code: 'KB', name: 'Kebun Binatang', location: 'Jl. Margasatwa No. 100', regularPrice: 40000, vipPrice: 60000, status: 'active'}
            ];
            
            // Populate destination dropdowns
            populateDestinationDropdowns();
            
            // Sample tickets
            tickets = [
                {code: 'TWA-001', type: 'regular', destination: 'Taman Wisata Alam', price: 50000, validDate: '2023-06-10', status: 'valid'},
                {code: 'MB-001', type: 'student', destination: 'Museum Bahari', price: 20000, validDate: '2023-06-11', status: 'valid'},
                {code: 'KB-001', type: 'vip', destination: 'Kebun Binatang', price: 60000, validDate: '2023-06-09', status: 'used'},
                {code: 'TWA-002', type: 'regular', destination: 'Taman Wisata Alam', price: 50000, validDate: '2023-06-08', status: 'expired'}
            ];
            
            // Sample users
            users = [
                {fullName: 'Admin', username: 'admin', password: CryptoJS.SHA256('password').toString(), role: 'admin', lastLogin: '2023-06-10 14:30:00', status: 'active', permissions: rolePermissions.admin},
                {fullName: 'Kasir 1', username: 'kasir1', password: CryptoJS.SHA256('password').toString(), role: 'cashier', lastLogin: '2023-06-10 10:15:00', status: 'active', permissions: rolePermissions.cashier},
                {fullName: 'Manager', username: 'manager', password: CryptoJS.SHA256('password').toString(), role: 'manager', lastLogin: '2023-06-09 16:45:00', status: 'active', permissions: rolePermissions.manager}
            ];
            
            // Sample transactions
            transactions = [
                {id: generateTransactionId(), date: '2023-06-10 10:30:00', items: [{ticket: 'TWA-001', price: 50000}], total: 50000, cashier: 'Kasir 1'},
                {id: generateTransactionId(), date: '2023-06-10 11:45:00', items: [{ticket: 'MB-001', price: 20000}, {ticket: 'KB-001', price: 60000}], total: 80000, cashier: 'Kasir 1'},
                {id: generateTransactionId(), date: '2023-06-09 15:20:00', items: [{ticket: 'TWA-002', price: 50000}], total: 50000, cashier: 'Manager'}
            ];

            // Sample backup history
            backupHistory = [
                {date: '2023-06-10 10:00:00', type: 'automatic', size: '15 KB', by: 'System'},
                {date: '2023-06-09 18:00:00', type: 'manual', size: '12 KB', by: 'Admin'}
            ];
            
            // Update dashboard
            refreshDashboard();
        }

        // Generate unique transaction ID
        function generateTransactionId() {
            const timestamp = Date.now().toString(36);
            const random = Math.random().toString(36).substr(2, 5);
            return `TRX-${timestamp}-${random}`.toUpperCase();
        }
        
        // Populate destination dropdowns
        function populateDestinationDropdowns() {
            const destinationDropdowns = [
                document.getElementById('destination'),
                document.getElementById('reportDestination')
            ];
            
            destinationDropdowns.forEach(dropdown => {
                if (dropdown) {
                    dropdown.innerHTML = '<option value="">Pilih Destinasi</option>' + 
                        products.map(product => 
                            `<option value="${product.code}">${product.name}</option>`
                        ).join('');
                }
            });
        }
        
        // Handle login
        function handleLogin(e) {
            e.preventDefault();
            
            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;
            
            // Show loading
            const loadingModal = new bootstrap.Modal(document.getElementById('loadingModal'));
            loadingModal.show();
            
            // Simulate API call
            setTimeout(() => {
                // In a real app, this would be an actual authentication check
                const user = users.find(u => u.username === username);
                const hashedPassword = CryptoJS.SHA256(password).toString();
                
                if (user && user.password === hashedPassword) {
                    currentUser = user;
                    
                    // Update last login
                    const now = new Date();
                    user.lastLogin = now.toISOString().split('T')[0] + ' ' + now.toTimeString().split(' ')[0];
                    
                    // Hide login modal and show app
                    bootstrap.Modal.getInstance(document.getElementById('loginModal')).hide();
                    document.getElementById('appContainer').style.display = 'block';
                    
                    // Update user info in sidebar
                    document.getElementById('userName').textContent = user.fullName;
                    document.getElementById('userRole').textContent = user.role === 'admin' ? 'Super User' : 
                                                                   user.role === 'cashier' ? 'Kasir' : 
                                                                   user.role === 'manager' ? 'Manager' : 'Operator';
                    
                    // Show/hide menu items based on role
                    if (user.role === 'admin' || user.role === 'manager') {
                        document.getElementById('products-menu-item').style.display = 'block';
                        document.getElementById('settings-menu-item').style.display = 'block';
                    }
                    
                    if (user.role === 'admin') {
                        document.getElementById('users-menu-item').style.display = 'block';
                    }

                    // Show/hide backup buttons based on role
                    if (user.role === 'admin') {
                        document.getElementById('adminBackupButtons').style.display = 'flex';
                        document.getElementById('nonAdminBackupButtons').style.display = 'none';
                        document.getElementById('restoreCard').style.display = 'block';
                        document.getElementById('resetCard').style.display = 'block';
                    } else {
                        document.getElementById('adminBackupButtons').style.display = 'none';
                        document.getElementById('nonAdminBackupButtons').style.display = 'flex';
                        if (!user.permissions.restore) {
                            document.getElementById('restoreCard').style.display = 'none';
                        }
                        if (!user.permissions.reset) {
                            document.getElementById('resetCard').style.display = 'none';
                        }
                    }
                    
                    // Close loading modal
                    loadingModal.hide();
                    
                    // Show dashboard by default
                    showSection('dashboard');
                } else {
                    loadingModal.hide();
                    alert('Login gagal. Username atau password salah.');
                }
            }, 1000);
        }
        
        // Logout function
        function logout() {
            currentUser = null;
            document.getElementById('appContainer').style.display = 'none';
            document.getElementById('loginUsername').value = '';
            document.getElementById('loginPassword').value = '';
            
            // Hide all menu items except dashboard
            document.getElementById('products-menu-item').style.display = 'none';
            document.getElementById('users-menu-item').style.display = 'none';
            document.getElementById('settings-menu-item').style.display = 'none';
            
            // Show login modal
            const loginModal = new bootstrap.Modal(document.getElementById('loginModal'));
            loginModal.show();
        }
        
        // Show section function with permission check
        function showSection(sectionId) {
            // Check permissions
            if (currentUser && !currentUser.permissions[sectionId]) {
                document.querySelectorAll('[id$="-section"]').forEach(section => {
                    section.style.display = 'none';
                });
                document.getElementById('access-denied-section').style.display = 'block';
                return;
            }
            
            // Hide all sections first
            document.querySelectorAll('[id$="-section"]').forEach(section => {
                section.style.display = 'none';
            });
            
            // Show the selected section
            document.getElementById(`${sectionId}-section`).style.display = 'block';
            
            // Update active menu item
            document.querySelectorAll('.sidebar .nav-link').forEach(link => {
                link.classList.remove('active');
            });
            
            // Find and activate the corresponding menu item
            const menuItem = document.querySelector(`.sidebar .nav-link[onclick="showSection('${sectionId}')"]`);
            if (menuItem) {
                menuItem.classList.add('active');
            }
            
            // Load section-specific data
            switch(sectionId) {
                case 'dashboard':
                    refreshDashboard();
                    break;
                case 'ticket-sales':
                    loadAvailableTickets();
                    break;
                case 'generate-ticket':
                    updateTicketCode();
                    break;
                case 'ticket-list':
                    loadTicketList();
                    break;
                case 'reports':
                    loadReportData();
                    break;
                case 'products':
                    loadProducts();
                    break;
                case 'users':
                    loadUsers();
                    break;
                case 'backup':
                    loadBackupHistory();
                    break;
            }
        }
        
        // Refresh dashboard data
        function refreshDashboard() {
            // Update summary cards
            document.getElementById('todaySales').textContent = transactions.length;
            document.getElementById('todayRevenue').textContent = `Rp${transactions.reduce((sum, trx) => sum + trx.total, 0).toLocaleString()}`;
            document.getElementById('todayVisitors').textContent = tickets.filter(t => t.status === 'used').length;
            document.getElementById('availableTickets').textContent = tickets.filter(t => t.status === 'valid').length;
            
            // Load recent transactions
            const recentTransactions = document.getElementById('recentTransactions');
            recentTransactions.innerHTML = transactions.slice(0, 5).map(trx => `
                <tr>
                    <td>${trx.id}</td>
                    <td>${trx.date.split(' ')[0]}</td>
                    <td>${trx.items.length}</td>
                    <td>Rp${trx.total.toLocaleString()}</td>
                </tr>
            `).join('');
            
            // Load recent activities
            const recentActivities = document.getElementById('recentActivities');
            recentActivities.innerHTML = [
                {user: 'Admin', action: 'membuat 10 karcis baru', time: '2 menit lalu'},
                {user: 'Kasir 1', action: 'melakukan transaksi TRX004', time: '15 menit lalu'},
                {user: 'Manager', action: 'mengupdate harga produk', time: '1 jam lalu'},
                {user: 'Kasir 1', action: 'melakukan transaksi TRX003', time: '2 jam lalu'},
                {user: 'Admin', action: 'menambahkan pengguna baru', time: '5 jam lalu'}
            ].map(activity => `
                <div class="list-group-item">
                    <div class="d-flex justify-content-between">
                        <span><strong>${activity.user}</strong> ${activity.action}</span>
                        <small class="text-muted">${activity.time}</small>
                    </div>
                </div>
            `).join('');
            
            // Initialize charts
            initDashboardCharts();
        }
        
        // Initialize dashboard charts
        function initDashboardCharts() {
            // Sales chart
            const salesCtx = document.getElementById('salesChart').getContext('2d');
            const salesChart = new Chart(salesCtx, {
                type: 'line',
                data: {
                    labels: ['Sen', 'Sel', 'Rab', 'Kam', 'Jum', 'Sab', 'Min'],
                    datasets: [{
                        label: 'Penjualan',
                        data: [12, 19, 15, 22, 18, 25, 30],
                        backgroundColor: 'rgba(52, 152, 219, 0.2)',
                        borderColor: 'rgba(52, 152, 219, 1)',
                        borderWidth: 2,
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
            
            // Top products chart
            const topProductsCtx = document.getElementById('topProductsChart').getContext('2d');
            const topProductsChart = new Chart(topProductsCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Taman Wisata', 'Museum', 'Kebun Binatang'],
                    datasets: [{
                        data: [45, 30, 25],
                        backgroundColor: [
                            'rgba(52, 152, 219, 0.7)',
                            'rgba(46, 204, 113, 0.7)',
                            'rgba(155, 89, 182, 0.7)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }
        
        // Load available tickets for sales
        function loadAvailableTickets() {
            const availableTicketsTable = document.getElementById('availableTicketsTable');
            const validTickets = tickets.filter(t => t.status === 'valid');
            
            availableTicketsTable.innerHTML = validTickets.map(ticket => `
                <tr>
                    <td>${ticket.code}</td>
                    <td>${ticket.destination}</td>
                    <td>${ticket.type === 'regular' ? 'Reguler' : 
                         ticket.type === 'vip' ? 'VIP' : 
                         ticket.type === 'student' ? 'Pelajar' : 
                         ticket.type === 'foreigner' ? 'WNA' : 'Grup'}</td>
                    <td>Rp${ticket.price.toLocaleString()}</td>
                    <td>${new Date(ticket.validDate).toLocaleDateString('id-ID')}</td>
                    <td>
                        <button class="btn btn-sm btn-primary" onclick="addToCart('${ticket.code}')">
                            <i class="fas fa-plus"></i> Tambah
                        </button>
                    </td>
                </tr>
            `).join('');
        }
        
        // Add ticket to cart
        function addToCart(ticketCode) {
            const ticket = tickets.find(t => t.code === ticketCode);
            if (ticket) {
                cart.push(ticket);
                updateCart();
            }
        }
        
        // Update cart display
        function updateCart() {
            const cartItems = document.getElementById('cartItems');
            const totalElement = document.getElementById('total');
            
            cartItems.innerHTML = cart.map(ticket => `
                <tr>
                    <td>${ticket.destination} (${ticket.type === 'regular' ? 'Reguler' : 
                                                  ticket.type === 'vip' ? 'VIP' : 
                                                  ticket.type === 'student' ? 'Pelajar' : 
                                                  ticket.type === 'foreigner' ? 'WNA' : 'Grup'})</td>
                    <td>Rp${ticket.price.toLocaleString()}</td>
                    <td class="text-end">
                        <button class="btn btn-sm btn-danger" onclick="removeFromCart('${ticket.code}')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                </tr>
            `).join('');
            
            const total = cart.reduce((sum, ticket) => sum + ticket.price, 0);
            totalElement.textContent = `Rp${total.toLocaleString()}`;
            
            // Update ticket preview
            if (cart.length > 0) {
                const firstTicket = cart[0];
                document.getElementById('barcode-preview').innerHTML = '';
                JsBarcode('#barcode-preview', firstTicket.code, {
                    format: 'CODE128',
                    lineColor: '#000',
                    width: 2,
                    height: 50,
                    displayValue: true
                });
                
                document.querySelector('#ticketPreviewContent h4').textContent = firstTicket.destination;
                document.querySelector('#ticketPreviewContent p').textContent = products.find(p => p.name === firstTicket.destination)?.location || '';
                document.querySelectorAll('#ticketPreviewContent p.fw-bold')[0].textContent = firstTicket.code;
                document.querySelectorAll('#ticketPreviewContent p.fw-bold')[1].textContent = new Date(firstTicket.validDate).toLocaleDateString('id-ID', {day: 'numeric', month: 'short', year: 'numeric'});
                document.querySelectorAll('#ticketPreviewContent p.fw-bold')[2].textContent = `Rp${firstTicket.price.toLocaleString()}`;
            }
            
            // Update change amount
            updateChangeAmount();
        }
        
        // Remove item from cart
        function removeFromCart(ticketCode) {
            cart = cart.filter(ticket => ticket.code !== ticketCode);
            updateCart();
        }

        // Clear cart
        function clearCart() {
            cart = [];
            updateCart();
        }

        // Update change amount based on cash received
        function updateChangeAmount() {
            const total = cart.reduce((sum, ticket) => sum + ticket.price, 0);
            const cashReceived = parseFloat(document.getElementById('cashReceived').value) || 0;
            const change = cashReceived - total;
            
            document.getElementById('changeAmount').value = `Rp${change >= 0 ? change.toLocaleString() : '0'}`;
        }

        // Update payment method
        function updatePaymentMethod() {
            const method = document.getElementById('paymentMethod').value;
            document.getElementById('cashInputContainer').style.display = method === 'cash' ? 'block' : 'none';
        }

        // Complete transaction
        function completeTransaction() {
            if (cart.length === 0) {
                alert('Keranjang belanja kosong!');
                return;
            }

            const paymentMethod = document.getElementById('paymentMethod').value;
            const cashReceived = parseFloat(document.getElementById('cashReceived').value) || 0;
            const total = cart.reduce((sum, ticket) => sum + ticket.price, 0);

            if (paymentMethod === 'cash' && cashReceived < total) {
                alert('Uang yang diterima kurang dari total pembayaran!');
                return;
            }

            // Generate transaction ID
            const transactionId = generateTransactionId();
            const now = new Date();
            const transactionDate = now.toISOString().split('T')[0] + ' ' + now.toTimeString().split(' ')[0];

            // Create transaction
            const transaction = {
                id: transactionId,
                date: transactionDate,
                items: cart.map(ticket => ({ ticket: ticket.code, price: ticket.price })),
                total: total,
                cashier: currentUser.fullName,
                paymentMethod: paymentMethod
            };

            // Add to transactions
            transactions.push(transaction);

            // Update ticket status
            cart.forEach(ticket => {
                const t = tickets.find(t => t.code === ticket.code);
                if (t) t.status = 'used';
            });

            // Show receipt
            printReceipt(transaction);

            // Clear cart
            clearCart();
            document.getElementById('cashReceived').value = '0';

            // Refresh dashboard
            refreshDashboard();

            alert('Transaksi berhasil disimpan!');
        }

        // Print receipt
        function printReceipt(transaction) {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();

            // Add receipt content
            doc.setFontSize(18);
            doc.text(document.getElementById('appName').value || 'TourTick', 105, 15, { align: 'center' });
            doc.setFontSize(12);
            doc.text('Sistem Karcis Pariwisata', 105, 22, { align: 'center' });
            doc.text('--------------------------------', 105, 28, { align: 'center' });

            doc.setFontSize(10);
            doc.text(`ID Transaksi: ${transaction.id}`, 14, 35);
            doc.text(`Tanggal: ${transaction.date}`, 14, 40);
            doc.text(`Kasir: ${transaction.cashier}`, 14, 45);
            doc.text('--------------------------------', 105, 50, { align: 'center' });

            // Add items
            let y = 57;
            transaction.items.forEach(item => {
                const ticket = tickets.find(t => t.code === item.ticket);
                doc.text(`${ticket.destination} (${ticket.type})`, 14, y);
                doc.text(`Rp${item.price.toLocaleString()}`, 190, y, { align: 'right' });
                y += 5;
            });

            doc.text('--------------------------------', 105, y, { align: 'center' });
            y += 7;

            // Add totals
            doc.text('Subtotal:', 14, y);
            doc.text(`Rp${transaction.total.toLocaleString()}`, 190, y, { align: 'right' });
            y += 5;

            if (document.getElementById('enableTax').checked) {
                const taxRate = parseFloat(document.getElementById('taxRate').value) || 0;
                const taxAmount = transaction.total * (taxRate / 100);
                doc.text(`Pajak (${taxRate}%):`, 14, y);
                doc.text(`Rp${taxAmount.toLocaleString()}`, 190, y, { align: 'right' });
                y += 5;
                
                doc.text('Total:', 14, y);
                doc.text(`Rp${(transaction.total + taxAmount).toLocaleString()}`, 190, y, { align: 'right' });
                y += 5;
            }

            doc.text('--------------------------------', 105, y, { align: 'center' });
            y += 7;

            doc.text(`Metode Pembayaran: ${transaction.paymentMethod}`, 14, y);
            y += 5;

            if (transaction.paymentMethod === 'cash') {
                const cashReceived = parseFloat(document.getElementById('cashReceived').value) || 0;
                const change = cashReceived - transaction.total;
                
                doc.text(`Tunai:`, 14, y);
                doc.text(`Rp${cashReceived.toLocaleString()}`, 190, y, { align: 'right' });
                y += 5;

                doc.text(`Kembalian:`, 14, y);
                doc.text(`Rp${change.toLocaleString()}`, 190, y, { align: 'right' });
                y += 5;
            }

            doc.text('--------------------------------', 105, y, { align: 'center' });
            y += 7;

            doc.setFontSize(8);
            doc.text(document.getElementById('receiptHeader').value || 'Terima kasih telah berkunjung', 105, y, { align: 'center' });
            y += 4;
            doc.text(document.getElementById('receiptFooter').value || 'Barang yang sudah dibeli tidak dapat dikembalikan', 105, y, { align: 'center' });

            // Open PDF in new tab
            doc.output('dataurlnewwindow');
        }

        // Print ticket
        function printTicket() {
            if (cart.length === 0) {
                alert('Tidak ada karcis untuk dicetak!');
                return;
            }

            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();

            cart.forEach((ticket, index) => {
                if (index > 0) doc.addPage();
                
                doc.setFontSize(16);
                doc.text(ticket.destination, 105, 15, { align: 'center' });
                doc.setFontSize(10);
                doc.text(products.find(p => p.name === ticket.destination)?.location || '', 105, 22, { align: 'center' });
                doc.text('--------------------------------', 105, 28, { align: 'center' });

                // Generate barcode image
                const barcodeSvg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
                JsBarcode(barcodeSvg, ticket.code, {
                    format: 'CODE128',
                    lineColor: '#000',
                    width: 2,
                    height: 40,
                    displayValue: true
                });

                const svgString = new XMLSerializer().serializeToString(barcodeSvg);
                const svgUrl = 'data:image/svg+xml;base64,' + btoa(unescape(encodeURIComponent(svgString)));
                
                doc.addImage(svgUrl, 'JPEG', 60, 35, 90, 40);

                doc.setFontSize(10);
                doc.text(`Kode: ${ticket.code}`, 14, 85);
                doc.text(`Jenis: ${ticket.type === 'regular' ? 'Reguler' : 
                                      ticket.type === 'vip' ? 'VIP' : 
                                      ticket.type === 'student' ? 'Pelajar' : 
                                      ticket.type === 'foreigner' ? 'WNA' : 'Grup'}`, 14, 90);
                doc.text(`Tanggal: ${new Date(ticket.validDate).toLocaleDateString('id-ID')}`, 14, 95);
                doc.text(`Harga: Rp${ticket.price.toLocaleString()}`, 14, 100);
                doc.text(`Status: Valid`, 14, 105);

                doc.text('--------------------------------', 105, 110, { align: 'center' });
                doc.setFontSize(8);
                doc.text('Karcis ini hanya berlaku pada tanggal yang tertera', 105, 115, { align: 'center' });
            });

            doc.output('dataurlnewwindow');
        }

        // Update ticket code when type or destination changes
        function updateTicketCode() {
            const type = document.getElementById('ticketType').value;
            const destination = document.getElementById('destination').value;
            
            if (!type || !destination) return;

            const product = products.find(p => p.code === destination);
            if (!product) return;

            // Generate sample code
            const ticketCount = tickets.filter(t => t.destination === product.name).length + 1;
            const ticketCode = `${product.code}-${ticketCount.toString().padStart(3, '0')}`;

            // Update preview
            document.getElementById('previewCode').textContent = ticketCode;
            document.getElementById('previewType').textContent = 
                type === 'regular' ? 'Reguler' : 
                type === 'vip' ? 'VIP' : 
                type === 'student' ? 'Pelajar/Mahasiswa' : 
                type === 'foreigner' ? 'Warga Asing' : 'Grup';

            // Generate barcode
            document.getElementById('barcode').innerHTML = '';
            JsBarcode('#barcode', ticketCode, {
                format: 'CODE128',
                lineColor: '#000',
                width: 2,
                height: 50,
                displayValue: true
            });
        }

        // Update destination details when destination changes
        function updateDestinationDetails() {
            const destination = document.getElementById('destination').value;
            const product = products.find(p => p.code === destination);
            
            if (product) {
                document.getElementById('previewDestination').textContent = product.name;
                document.getElementById('previewAddress').textContent = product.location;
                
                // Set default price based on ticket type
                const type = document.getElementById('ticketType').value;
                let price = product.regularPrice;
                
                if (type === 'vip' && product.vipPrice) {
                    price = product.vipPrice;
                } else if (type === 'student') {
                    price = product.regularPrice * 0.7; // 30% discount for students
                } else if (type === 'foreigner') {
                    price = product.regularPrice * 1.5; // 50% more for foreigners
                } else if (type === 'group') {
                    price = product.regularPrice * 0.8; // 20% discount for groups
                }
                
                document.getElementById('ticketPrice').value = price;
                document.getElementById('previewPrice').textContent = `Rp${price.toLocaleString()}`;
            }
        }

        // Generate barcode
        function generateBarcode() {
            const type = document.getElementById('ticketType').value;
            const destination = document.getElementById('destination').value;
            
            if (!type || !destination) {
                alert('Pilih jenis karcis dan destinasi terlebih dahulu!');
                return;
            }

            updateTicketCode();
        }

        // Save ticket
        function saveTicket(e) {
            e.preventDefault();

            const type = document.getElementById('ticketType').value;
            const destination = document.getElementById('destination').value;
            const price = parseFloat(document.getElementById('ticketPrice').value);
            const quantity = parseInt(document.getElementById('ticketQuantity').value);
            const validDate = document.getElementById('validDate').value;
            
            if (!type || !destination || isNaN(price) || isNaN(quantity) || !validDate) {
                alert('Harap isi semua field yang diperlukan!');
                return;
            }

            const product = products.find(p => p.code === destination);
            if (!product) return;

            // Generate tickets
            for (let i = 0; i < quantity; i++) {
                const ticketCount = tickets.filter(t => t.destination === product.name).length + i + 1;
                const ticketCode = `${product.code}-${ticketCount.toString().padStart(3, '0')}`;
                
                tickets.push({
                    code: ticketCode,
                    type: type,
                    destination: product.name,
                    price: price,
                    validDate: validDate,
                    status: 'valid'
                });
            }

            alert(`${quantity} karcis berhasil disimpan!`);
            document.getElementById('ticketForm').reset();
            updateTicketCode();
        }

        // Print generated ticket
        function printGeneratedTicket() {
            const type = document.getElementById('ticketType').value;
            const destination = document.getElementById('destination').value;
            
            if (!type || !destination) {
                alert('Pilih jenis karcis dan destinasi terlebih dahulu!');
                return;
            }

            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();

            doc.setFontSize(16);
            doc.text(document.getElementById('previewDestination').textContent, 105, 15, { align: 'center' });
            doc.setFontSize(10);
            doc.text(document.getElementById('previewAddress').textContent, 105, 22, { align: 'center' });
            doc.text('--------------------------------', 105, 28, { align: 'center' });

            // Get barcode SVG
            const barcodeSvg = document.getElementById('barcode').querySelector('svg');
            const svgString = new XMLSerializer().serializeToString(barcodeSvg);
            const svgUrl = 'data:image/svg+xml;base64,' + btoa(unescape(encodeURIComponent(svgString)));
            
            doc.addImage(svgUrl, 'JPEG', 60, 35, 90, 50);

            doc.setFontSize(10);
            doc.text(`Kode: ${document.getElementById('previewCode').textContent}`, 14, 95);
            doc.text(`Jenis: ${type === 'regular' ? 'Reguler' : 
                                  type === 'vip' ? 'VIP' : 
                                  type === 'student' ? 'Pelajar/Mahasiswa' : 
                                  type === 'foreigner' ? 'Warga Asing' : 'Grup'}`, 14, 100);
            doc.text(`Tanggal: ${document.getElementById('previewDate').textContent}`, 14, 105);
            doc.text(`Harga: ${document.getElementById('previewPrice').textContent}`, 14, 110);
            doc.text(`Status: Belum Digunakan`, 14, 115);

            doc.text('--------------------------------', 105, 120, { align: 'center' });
            doc.setFontSize(8);
            doc.text('Karcis ini hanya berlaku pada tanggal yang tertera', 105, 125, { align: 'center' });

            doc.output('dataurlnewwindow');
        }

        // Load ticket list
        function loadTicketList() {
            const ticketTableBody = document.getElementById('ticketTableBody');
            const filter = document.getElementById('ticketFilter').value;
            
            let filteredTickets = tickets;
            if (filter !== 'all') {
                filteredTickets = tickets.filter(t => t.status === filter);
            }

            ticketTableBody.innerHTML = filteredTickets.map(ticket => `
                <tr>
                    <td>${ticket.code}</td>
                    <td>${ticket.destination}</td>
                    <td>${ticket.type === 'regular' ? 'Reguler' : 
                         ticket.type === 'vip' ? 'VIP' : 
                         ticket.type === 'student' ? 'Pelajar' : 
                         ticket.type === 'foreigner' ? 'WNA' : 'Grup'}</td>
                    <td>Rp${ticket.price.toLocaleString()}</td>
                    <td>${new Date(ticket.validDate).toLocaleDateString('id-ID')}</td>
                    <td>
                        <span class="badge ${ticket.status === 'valid' ? 'badge-valid' : 
                                            ticket.status === 'used' ? 'badge-used' : 'badge-expired'}">
                            ${ticket.status === 'valid' ? 'Valid' : 
                             ticket.status === 'used' ? 'Digunakan' : 'Kadaluarsa'}
                        </span>
                    </td>
                    <td>
                        <button class="btn btn-sm btn-primary me-1" onclick="viewTicket('${ticket.code}')">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="btn btn-sm btn-danger" onclick="deleteTicket('${ticket.code}')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        // View ticket details
        function viewTicket(ticketCode) {
            const ticket = tickets.find(t => t.code === ticketCode);
            if (!ticket) return;

            const product = products.find(p => p.name === ticket.destination);
            
            document.getElementById('viewTicketDestination').textContent = ticket.destination;
            document.getElementById('viewTicketAddress').textContent = product?.location || '';
            document.getElementById('viewTicketType').textContent = 
                ticket.type === 'regular' ? 'Reguler' : 
                ticket.type === 'vip' ? 'VIP' : 
                ticket.type === 'student' ? 'Pelajar' : 
                ticket.type === 'foreigner' ? 'WNA' : 'Grup';
            document.getElementById('viewTicketCode').textContent = ticket.code;
            document.getElementById('viewTicketDate').textContent = new Date(ticket.validDate).toLocaleDateString('id-ID');
            document.getElementById('viewTicketPrice').textContent = `Rp${ticket.price.toLocaleString()}`;
            document.getElementById('viewTicketStatus').textContent = 
                ticket.status === 'valid' ? 'Valid' : 
                ticket.status === 'used' ? 'Digunakan' : 'Kadaluarsa';
            document.getElementById('viewTicketStatus').className = 
                `mb-0 fw-bold ${ticket.status === 'valid' ? 'text-success' : 
                               ticket.status === 'used' ? 'text-info' : 'text-danger'}`;

            // Generate barcode
            document.getElementById('viewTicketBarcode').innerHTML = '';
            JsBarcode('#viewTicketBarcode', ticket.code, {
                format: 'CODE128',
                lineColor: '#000',
                width: 2,
                height: 50,
                displayValue: true
            });

            // Show modal
            const viewTicketModal = new bootstrap.Modal(document.getElementById('viewTicketModal'));
            viewTicketModal.show();
        }

        // Delete ticket
        function deleteTicket(ticketCode) {
            if (confirm('Apakah Anda yakin ingin menghapus karcis ini?')) {
                tickets = tickets.filter(t => t.code !== ticketCode);
                loadTicketList();
                alert('Karcis berhasil dihapus!');
            }
        }

        // Print single ticket
        function printSingleTicket() {
            const ticketCode = document.getElementById('viewTicketCode').textContent;
            const ticket = tickets.find(t => t.code === ticketCode);
            if (!ticket) return;

            const { jsPDF } = window.jsPDF;
            const doc = new jsPDF();

            doc.setFontSize(16);
            doc.text(ticket.destination, 105, 15, { align: 'center' });
            doc.setFontSize(10);
            doc.text(products.find(p => p.name === ticket.destination)?.location || '', 105, 22, { align: 'center' });
            doc.text('--------------------------------', 105, 28, { align: 'center' });

            // Get barcode SVG
            const barcodeSvg = document.getElementById('viewTicketBarcode').querySelector('svg');
            const svgString = new XMLSerializer().serializeToString(barcodeSvg);
            const svgUrl = 'data:image/svg+xml;base64,' + btoa(unescape(encodeURIComponent(svgString)));
            
            doc.addImage(svgUrl, 'JPEG', 60, 35, 90, 50);

            doc.setFontSize(10);
            doc.text(`Kode: ${ticket.code}`, 14, 95);
            doc.text(`Jenis: ${ticket.type === 'regular' ? 'Reguler' : 
                                      ticket.type === 'vip' ? 'VIP' : 
                                      ticket.type === 'student' ? 'Pelajar' : 
                                      ticket.type === 'foreigner' ? 'WNA' : 'Grup'}`, 14, 100);
            doc.text(`Tanggal: ${new Date(ticket.validDate).toLocaleDateString('id-ID')}`, 14, 105);
            doc.text(`Harga: Rp${ticket.price.toLocaleString()}`, 14, 110);
            doc.text(`Status: ${ticket.status === 'valid' ? 'Valid' : 
                               ticket.status === 'used' ? 'Digunakan' : 'Kadaluarsa'}`, 14, 115);

            doc.text('--------------------------------', 105, 120, { align: 'center' });
            doc.setFontSize(8);
            doc.text('Karcis ini hanya berlaku pada tanggal yang tertera', 105, 125, { align: 'center' });

            doc.output('dataurlnewwindow');
        }

        // Search tickets
        function searchTickets() {
            const searchTerm = document.getElementById('ticketSearch').value.toLowerCase();
            const filter = document.getElementById('ticketFilter').value;
            
            let filteredTickets = tickets;
            if (filter !== 'all') {
                filteredTickets = tickets.filter(t => t.status === filter);
            }

            filteredTickets = filteredTickets.filter(ticket => 
                ticket.code.toLowerCase().includes(searchTerm) || 
                ticket.destination.toLowerCase().includes(searchTerm) ||
                ticket.type.toLowerCase().includes(searchTerm)
            );

            const ticketTableBody = document.getElementById('ticketTableBody');
            ticketTableBody.innerHTML = filteredTickets.map(ticket => `
                <tr>
                    <td>${ticket.code}</td>
                    <td>${ticket.destination}</td>
                    <td>${ticket.type === 'regular' ? 'Reguler' : 
                         ticket.type === 'vip' ? 'VIP' : 
                         ticket.type === 'student' ? 'Pelajar' : 
                         ticket.type === 'foreigner' ? 'WNA' : 'Grup'}</td>
                    <td>Rp${ticket.price.toLocaleString()}</td>
                    <td>${new Date(ticket.validDate).toLocaleDateString('id-ID')}</td>
                    <td>
                        <span class="badge ${ticket.status === 'valid' ? 'badge-valid' : 
                                            ticket.status === 'used' ? 'badge-used' : 'badge-expired'}">
                            ${ticket.status === 'valid' ? 'Valid' : 
                             ticket.status === 'used' ? 'Digunakan' : 'Kadaluarsa'}
                        </span>
                    </td>
                    <td>
                        <button class="btn btn-sm btn-primary me-1" onclick="viewTicket('${ticket.code}')">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="btn btn-sm btn-danger" onclick="deleteTicket('${ticket.code}')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        // Filter tickets
        function filterTickets() {
            searchTickets();
        }

        // Search tickets in sales section
        function searchTicketsSales() {
            const searchTerm = document.getElementById('ticketSearchSales').value.toLowerCase();
            const validTickets = tickets.filter(t => t.status === 'valid');
            const filteredTickets = validTickets.filter(ticket => 
                ticket.code.toLowerCase().includes(searchTerm) || 
                ticket.destination.toLowerCase().includes(searchTerm) ||
                ticket.type.toLowerCase().includes(searchTerm)
            );

            const availableTicketsTable = document.getElementById('availableTicketsTable');
            availableTicketsTable.innerHTML = filteredTickets.map(ticket => `
                <tr>
                    <td>${ticket.code}</td>
                    <td>${ticket.destination}</td>
                    <td>${ticket.type === 'regular' ? 'Reguler' : 
                         ticket.type === 'vip' ? 'VIP' : 
                         ticket.type === 'student' ? 'Pelajar' : 
                         ticket.type === 'foreigner' ? 'WNA' : 'Grup'}</td>
                    <td>Rp${ticket.price.toLocaleString()}</td>
                    <td>${new Date(ticket.validDate).toLocaleDateString('id-ID')}</td>
                    <td>
                        <button class="btn btn-sm btn-primary" onclick="addToCart('${ticket.code}')">
                            <i class="fas fa-plus"></i> Tambah
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        // Export tickets
        function exportTickets() {
            const { jsPDF } = window.jsPDF;
            const doc = new jsPDF();

            // Add title
            doc.setFontSize(16);
            doc.text('Daftar Karcis TourTick', 105, 15, { align: 'center' });
            doc.setFontSize(10);
            doc.text(`Tanggal: ${new Date().toLocaleDateString('id-ID')}`, 105, 22, { align: 'center' });
            doc.text('--------------------------------', 105, 28, { align: 'center' });

            // Add table headers
            doc.setFontSize(10);
            doc.setFont(undefined, 'bold');
            doc.text('Kode', 15, 35);
            doc.text('Destinasi', 45, 35);
            doc.text('Jenis', 90, 35);
            doc.text('Harga', 130, 35);
            doc.text('Tanggal', 160, 35);
            doc.text('Status', 190, 35);
            doc.setFont(undefined, 'normal');

            // Add ticket data
            let y = 42;
            tickets.forEach(ticket => {
                doc.text(ticket.code, 15, y);
                doc.text(ticket.destination, 45, y);
                doc.text(ticket.type === 'regular' ? 'Reguler' : 
                         ticket.type === 'vip' ? 'VIP' : 
                         ticket.type === 'student' ? 'Pelajar' : 
                         ticket.type === 'foreigner' ? 'WNA' : 'Grup', 90, y);
                doc.text(`Rp${ticket.price.toLocaleString()}`, 130, y);
                doc.text(new Date(ticket.validDate).toLocaleDateString('id-ID'), 160, y);
                doc.text(ticket.status === 'valid' ? 'Valid' : 
                         ticket.status === 'used' ? 'Digunakan' : 'Kadaluarsa', 190, y);
                y += 7;
                
                // Add new page if needed
                if (y > 280) {
                    doc.addPage();
                    y = 20;
                }
            });

            doc.output('dataurlnewwindow');
        }

        // Show import modal
        function showImportModal() {
            const importModal = new bootstrap.Modal(document.getElementById('importTicketsModal'));
            importModal.show();
        }

        // Download import template
        function downloadImportTemplate() {
            const { jsPDF } = window.jsPDF;
            const doc = new jsPDF();

            // Add title
            doc.setFontSize(16);
            doc.text('Template Import Karcis', 105, 15, { align: 'center' });
            doc.setFontSize(10);
            doc.text('Isi data karcis sesuai format berikut', 105, 22, { align: 'center' });
            doc.text('--------------------------------', 105, 28, { align: 'center' });

            // Add table headers
            doc.setFontSize(10);
            doc.setFont(undefined, 'bold');
            doc.text('Kode', 15, 35);
            doc.text('Jenis (regular/vip/student/foreigner/group)', 45, 35);
            doc.text('Destinasi', 100, 35);
            doc.text('Harga', 150, 35);
            doc.text('Tanggal Berlaku (YYYY-MM-DD)', 180, 35);
            doc.setFont(undefined, 'normal');

            // Add example data
            doc.text('TWA-001', 15, 42);
            doc.text('regular', 45, 42);
            doc.text('Taman Wisata Alam', 100, 42);
            doc.text('50000', 150, 42);
            doc.text('2023-06-15', 180, 42);

            doc.text('MB-001', 15, 49);
            doc.text('student', 45, 49);
            doc.text('Museum Bahari', 100, 49);
            doc.text('20000', 150, 49);
            doc.text('2023-06-16', 180, 49);

            doc.output('dataurlnewwindow', { filename: 'Template_Import_Karcis.pdf' });
        }

        // Import tickets
        function importTickets() {
            const fileInput = document.getElementById('ticketImportFile');
            if (!fileInput.files.length) {
                alert('Pilih file terlebih dahulu!');
                return;
            }

            // In a real app, this would parse the Excel file
            // For demo, we'll just simulate importing 5 new tickets
            const newTickets = [
                { code: 'TWA-003', type: 'regular', destination: 'Taman Wisata Alam', price: 50000, validDate: '2023-06-15', status: 'valid' },
                { code: 'MB-002', type: 'student', destination: 'Museum Bahari', price: 20000, validDate: '2023-06-16', status: 'valid' },
                { code: 'KB-002', type: 'vip', destination: 'Kebun Binatang', price: 60000, validDate: '2023-06-17', status: 'valid' },
                { code: 'TWA-004', type: 'foreigner', destination: 'Taman Wisata Alam', price: 75000, validDate: '2023-06-18', status: 'valid' },
                { code: 'MB-003', type: 'group', destination: 'Museum Bahari', price: 24000, validDate: '2023-06-19', status: 'valid' }
            ];

            tickets = [...tickets, ...newTickets];
            bootstrap.Modal.getInstance(document.getElementById('importTicketsModal')).hide();
            loadTicketList();
            alert('5 karcis berhasil diimport!');
        }

        // Load report data
        function loadReportData() {
            const startDate = document.getElementById('reportStartDate').value;
            const endDate = document.getElementById('reportEndDate').value;
            const ticketType = document.getElementById('reportTicketType').value;
            const destination = document.getElementById('reportDestination').value;

            // Filter transactions
            let filteredTransactions = transactions;
            
            if (startDate && endDate) {
                filteredTransactions = filteredTransactions.filter(trx => {
                    const trxDate = trx.date.split(' ')[0];
                    return trxDate >= startDate && trxDate <= endDate;
                });
            }
            
            if (ticketType !== 'all') {
                filteredTransactions = filteredTransactions.filter(trx => 
                    trx.items.some(item => {
                        const ticket = tickets.find(t => t.code === item.ticket);
                        return ticket && ticket.type === ticketType;
                    })
                );
            }
            
            if (destination !== 'all') {
                filteredTransactions = filteredTransactions.filter(trx => 
                    trx.items.some(item => {
                        const ticket = tickets.find(t => t.code === item.ticket);
                        const product = products.find(p => p.name === ticket?.destination);
                        return product && product.code === destination;
                    })
                );
            }

            // Update report table
            const reportTableBody = document.getElementById('reportTableBody');
            reportTableBody.innerHTML = filteredTransactions.map(trx => `
                <tr>
                    <td>${trx.id}</td>
                    <td>${trx.date}</td>
                    <td>
                        ${trx.items.map(item => {
                            const ticket = tickets.find(t => t.code === item.ticket);
                            return `${ticket?.destination} (${ticket?.type})`;
                        }).join(', ')}
                    </td>
                    <td>${trx.items.length}</td>
                    <td>Rp${trx.items.reduce((sum, item) => sum + item.price, 0).toLocaleString()}</td>
                    <td>Rp${trx.total.toLocaleString()}</td>
                    <td>${trx.cashier}</td>
                </tr>
            `).join('');

            // Initialize report chart
            initReportChart(filteredTransactions);
        }

        // Initialize report chart
        function initReportChart(filteredTransactions) {
            const ctx = document.getElementById('reportChart').getContext('2d');
            
            // Group transactions by date
            const transactionsByDate = {};
            filteredTransactions.forEach(trx => {
                const date = trx.date.split(' ')[0];
                if (!transactionsByDate[date]) {
                    transactionsByDate[date] = 0;
                }
                transactionsByDate[date] += trx.total;
            });

            const dates = Object.keys(transactionsByDate).sort();
            const amounts = dates.map(date => transactionsByDate[date]);

            // Create chart
            const chart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: dates,
                    datasets: [{
                        label: 'Pendapatan',
                        data: amounts,
                        backgroundColor: 'rgba(52, 152, 219, 0.7)',
                        borderColor: 'rgba(52, 152, 219, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return 'Rp' + context.raw.toLocaleString();
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return 'Rp' + value.toLocaleString();
                                }
                            }
                        }
                    }
                }
            });
        }

        // Generate daily report
        function generateDailyReport() {
            const { jsPDF } = window.jsPDF;
            const doc = new jsPDF();

            // Add title
            doc.setFontSize(16);
            doc.text('Laporan Harian TourTick', 105, 15, { align: 'center' });
            doc.setFontSize(10);
            doc.text(`Tanggal: ${new Date().toLocaleDateString('id-ID')}`, 105, 22, { align: 'center' });
            doc.text('--------------------------------', 105, 28, { align: 'center' });

            // Add summary
            doc.setFontSize(12);
            doc.text('Ringkasan Penjualan', 14, 35);
            doc.setFontSize(10);
            doc.text(`Total Transaksi: ${transactions.length}`, 14, 42);
            doc.text(`Total Pendapatan: Rp${transactions.reduce((sum, trx) => sum + trx.total, 0).toLocaleString()}`, 14, 49);
            doc.text(`Total Pengunjung: ${tickets.filter(t => t.status === 'used').length}`, 14, 56);
            doc.text('--------------------------------', 105, 63, { align: 'center' });

            // Add transaction details
            doc.setFontSize(12);
            doc.text('Detail Transaksi', 14, 70);
            doc.setFontSize(10);

            let y = 77;
            transactions.forEach(trx => {
                doc.text(`ID: ${trx.id}`, 14, y);
                doc.text(`Tanggal: ${trx.date}`, 14, y + 5);
                doc.text(`Kasir: ${trx.cashier}`, 14, y + 10);
                doc.text(`Total: Rp${trx.total.toLocaleString()}`, 14, y + 15);
                
                // Add items
                trx.items.forEach((item, index) => {
                    const ticket = tickets.find(t => t.code === item.ticket);
                    doc.text(`${index + 1}. ${ticket?.destination} (${ticket?.type}) - Rp${item.price.toLocaleString()}`, 20, y + 20 + (index * 5));
                });
                
                y += 25 + (trx.items.length * 5);
                doc.text('---', 105, y, { align: 'center' });
                y += 7;
                
                // Add new page if needed
                if (y > 280) {
                    doc.addPage();
                    y = 20;
                }
            });

            doc.output('dataurlnewwindow', { filename: 'Laporan_Harian_TourTick.pdf' });
        }

        // Export report data
        function exportReportData() {
            const { jsPDF } = window.jsPDF;
            const doc = new jsPDF();

            // Add title
            doc.setFontSize(16);
            doc.text('Data Laporan TourTick', 105, 15, { align: 'center' });
            doc.setFontSize(10);
            doc.text(`Tanggal: ${new Date().toLocaleDateString('id-ID')}`, 105, 22, { align: 'center' });
            doc.text('--------------------------------', 105, 28, { align: 'center' });

            // Add table headers
            doc.setFontSize(10);
            doc.setFont(undefined, 'bold');
            doc.text('ID Transaksi', 15, 35);
            doc.text('Tanggal', 45, 35);
            doc.text('Karcis', 80, 35);
            doc.text('Jumlah', 140, 35);
            doc.text('Harga', 160, 35);
            doc.text('Total', 190, 35);
            doc.text('Kasir', 220, 35);
            doc.setFont(undefined, 'normal');

            // Add transaction data
            let y = 42;
            transactions.forEach(trx => {
                doc.text(trx.id, 15, y);
                doc.text(trx.date, 45, y);
                
                // List tickets
                const ticketsText = trx.items.map(item => {
                    const ticket = tickets.find(t => t.code === item.ticket);
                    return `${ticket?.destination} (${ticket?.type})`;
                }).join(', ');
                
                doc.text(ticketsText, 80, y, { maxWidth: 60 });
                doc.text(trx.items.length.toString(), 140, y);
                doc.text(`Rp${trx.items.reduce((sum, item) => sum + item.price, 0).toLocaleString()}`, 160, y);
                doc.text(`Rp${trx.total.toLocaleString()}`, 190, y);
                doc.text(trx.cashier, 220, y);
                
                y += 7;
                
                // Add new page if needed
                if (y > 280) {
                    doc.addPage();
                    y = 20;
                }
            });

            doc.output('dataurlnewwindow', { filename: 'Data_Laporan_TourTick.pdf' });
        }

        // Load products
        function loadProducts() {
            const productTableBody = document.getElementById('productTableBody');
            
            productTableBody.innerHTML = products.map(product => `
                <tr>
                    <td>${product.code}</td>
                    <td>${product.name}</td>
                    <td>${product.location}</td>
                    <td>Rp${product.regularPrice.toLocaleString()}</td>
                    <td>
                        <span class="badge ${product.status === 'active' ? 'badge-valid' : 'badge-expired'}">
                            ${product.status === 'active' ? 'Aktif' : 'Nonaktif'}
                        </span>
                    </td>
                    <td>
                        <button class="btn btn-sm btn-primary me-1" onclick="editProduct('${product.code}')">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-sm btn-danger" onclick="deleteProduct('${product.code}')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        // Search products
        function searchProducts() {
            const searchTerm = document.getElementById('productSearch').value.toLowerCase();
            const filteredProducts = products.filter(product => 
                product.code.toLowerCase().includes(searchTerm) || 
                product.name.toLowerCase().includes(searchTerm) ||
                product.location.toLowerCase().includes(searchTerm)
            );

            const productTableBody = document.getElementById('productTableBody');
            productTableBody.innerHTML = filteredProducts.map(product => `
                <tr>
                    <td>${product.code}</td>
                    <td>${product.name}</td>
                    <td>${product.location}</td>
                    <td>Rp${product.regularPrice.toLocaleString()}</td>
                    <td>
                        <span class="badge ${product.status === 'active' ? 'badge-valid' : 'badge-expired'}">
                            ${product.status === 'active' ? 'Aktif' : 'Nonaktif'}
                        </span>
                    </td>
                    <td>
                        <button class="btn btn-sm btn-primary me-1" onclick="editProduct('${product.code}')">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-sm btn-danger" onclick="deleteProduct('${product.code}')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        // Show add product modal
        function showAddProductModal() {
            document.getElementById('addProductForm').reset();
            const addProductModal = new bootstrap.Modal(document.getElementById('addProductModal'));
            addProductModal.show();
        }

        // Edit product
        function editProduct(productCode) {
            const product = products.find(p => p.code === productCode);
            if (!product) return;

            document.getElementById('productCode').value = product.code;
            document.getElementById('productName').value = product.name;
            document.getElementById('productLocation').value = product.location;
            document.getElementById('productDescription').value = product.description || '';
            document.getElementById('productRegularPrice').value = product.regularPrice;
            document.getElementById('productVipPrice').value = product.vipPrice || '';
            document.getElementById('productStatus').checked = product.status === 'active';

            const addProductModal = new bootstrap.Modal(document.getElementById('addProductModal'));
            addProductModal.show();
        }

        // Save product
        function saveProduct() {
            const code = document.getElementById('productCode').value;
            const name = document.getElementById('productName').value;
            const location = document.getElementById('productLocation').value;
            const description = document.getElementById('productDescription').value;
            const regularPrice = parseFloat(document.getElementById('productRegularPrice').value);
            const vipPrice = parseFloat(document.getElementById('productVipPrice').value) || null;
            const status = document.getElementById('productStatus').checked ? 'active' : 'inactive';

            if (!code || !name || !location || isNaN(regularPrice)) {
                alert('Harap isi semua field yang diperlukan!');
                return;
            }

            // Check if product exists (edit mode)
            const existingIndex = products.findIndex(p => p.code === code);
            
            const product = {
                code,
                name,
                location,
                description,
                regularPrice,
                vipPrice,
                status
            };

            if (existingIndex >= 0) {
                // Update existing product
                products[existingIndex] = product;
                alert('Produk berhasil diperbarui!');
            } else {
                // Add new product
                products.push(product);
                alert('Produk berhasil ditambahkan!');
            }

            // Close modal and refresh list
            bootstrap.Modal.getInstance(document.getElementById('addProductModal')).hide();
            loadProducts();
            populateDestinationDropdowns();
        }

        // Delete product
        function deleteProduct(productCode) {
            if (confirm('Apakah Anda yakin ingin menghapus produk ini?')) {
                products = products.filter(p => p.code !== productCode);
                loadProducts();
                populateDestinationDropdowns();
                alert('Produk berhasil dihapus!');
            }
        }

        // Load users
        function loadUsers() {
            const userTableBody = document.getElementById('userTableBody');
            
            userTableBody.innerHTML = users.map(user => `
                <tr>
                    <td>${user.fullName}</td>
                    <td>${user.username}</td>
                    <td>${user.role === 'admin' ? 'Admin' : 
                         user.role === 'cashier' ? 'Kasir' : 
                         user.role === 'manager' ? 'Manager' : 'Operator'}</td>
                    <td>
                        <span class="badge ${user.status === 'active' ? 'badge-valid' : 'badge-expired'}">
                            ${user.status === 'active' ? 'Aktif' : 'Nonaktif'}
                        </span>
                    </td>
                    <td>${user.lastLogin}</td>
                    <td>
                        <button class="btn btn-sm btn-primary me-1" onclick="editUser('${user.username}')">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-sm btn-danger" onclick="deleteUser('${user.username}')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        // Search users
        function searchUsers() {
            const searchTerm = document.getElementById('userSearch').value.toLowerCase();
            const filteredUsers = users.filter(user => 
                user.fullName.toLowerCase().includes(searchTerm) || 
                user.username.toLowerCase().includes(searchTerm) ||
                user.role.toLowerCase().includes(searchTerm)
            );

            const userTableBody = document.getElementById('userTableBody');
            userTableBody.innerHTML = filteredUsers.map(user => `
                <tr>
                    <td>${user.fullName}</td>
                    <td>${user.username}</td>
                    <td>${user.role === 'admin' ? 'Admin' : 
                         user.role === 'cashier' ? 'Kasir' : 
                         user.role === 'manager' ? 'Manager' : 'Operator'}</td>
                    <td>
                        <span class="badge ${user.status === 'active' ? 'badge-valid' : 'badge-expired'}">
                            ${user.status === 'active' ? 'Aktif' : 'Nonaktif'}
                        </span>
                    </td>
                    <td>${user.lastLogin}</td>
                    <td>
                        <button class="btn btn-sm btn-primary me-1" onclick="editUser('${user.username}')">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-sm btn-danger" onclick="deleteUser('${user.username}')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        // Show add user modal
        function showAddUserModal() {
            document.getElementById('addUserForm').reset();
            
            // Load permission settings
            const permissionSettings = document.getElementById('permissionSettings');
            permissionSettings.innerHTML = `
                <h6>Hak Akses</h6>
                <div class="row">
                    <div class="col-md-6">
                        <div class="permission-item">
                            <input type="checkbox" class="permission-checkbox" id="permDashboard" checked disabled>
                            <label for="permDashboard">Dashboard</label>
                        </div>
                        <div class="permission-item">
                            <input type="checkbox" class="permission-checkbox" id="permTicketSales">
                            <label for="permTicketSales">Penjualan Karcis</label>
                        </div>
                        <div class="permission-item">
                            <input type="checkbox" class="permission-checkbox" id="permGenerateTicket">
                            <label for="permGenerateTicket">Generate Karcis</label>
                        </div>
                        <div class="permission-item">
                            <input type="checkbox" class="permission-checkbox" id="permTicketList">
                            <label for="permTicketList">Daftar Karcis</label>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="permission-item">
                            <input type="checkbox" class="permission-checkbox" id="permReports">
                            <label for="permReports">Laporan</label>
                        </div>
                        <div class="permission-item">
                            <input type="checkbox" class="permission-checkbox" id="permProducts">
                            <label for="permProducts">Produk Wisata</label>
                        </div>
                        <div class="permission-item">
                            <input type="checkbox" class="permission-checkbox" id="permSettings">
                            <label for="permSettings">Pengaturan</label>
                        </div>
                        <div class="permission-item">
                            <input type="checkbox" class="permission-checkbox" id="permBackup">
                            <label for="permBackup">Backup Data</label>
                        </div>
                    </div>
                </div>
            `;
            
            const addUserModal = new bootstrap.Modal(document.getElementById('addUserModal'));
            addUserModal.show();
        }

        // Edit user
        function editUser(username) {
            const user = users.find(u => u.username === username);
            if (!user) return;

            document.getElementById('userFullName').value = user.fullName;
            document.getElementById('userUsername').value = user.username;
            document.getElementById('userPassword').value = '';
            document.getElementById('userRole').value = user.role;
            document.getElementById('userStatus').checked = user.status === 'active';

            // Load permission settings
            const permissionSettings = document.getElementById('permissionSettings');
            permissionSettings.innerHTML = `
                <h6>Hak Akses</h6>
                <div class="row">
                    <div class="col-md-6">
                        <div class="permission-item">
                            <input type="checkbox" class="permission-checkbox" id="permDashboard" checked disabled>
                            <label for="permDashboard">Dashboard</label>
                        </div>
                        <div class="permission-item">
                            <input type="checkbox" class="permission-checkbox" id="permTicketSales" ${user.permissions.ticketSales ? 'checked' : ''}>
                            <label for="permTicketSales">Penjualan Karcis</label>
                        </div>
                        <div class="permission-item">
                            <input type="checkbox" class="permission-checkbox" id="permGenerateTicket" ${user.permissions.generateTicket ? 'checked' : ''}>
                            <label for="permGenerateTicket">Generate Karcis</label>
                        </div>
                        <div class="permission-item">
                            <input type="checkbox" class="permission-checkbox" id="permTicketList" ${user.permissions.ticketList ? 'checked' : ''}>
                            <label for="permTicketList">Daftar Karcis</label>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="permission-item">
                            <input type="checkbox" class="permission-checkbox" id="permReports" ${user.permissions.reports ? 'checked' : ''}>
                            <label for="permReports">Laporan</label>
                        </div>
                        <div class="permission-item">
                            <input type="checkbox" class="permission-checkbox" id="permProducts" ${user.permissions.products ? 'checked' : ''}>
                            <label for="permProducts">Produk Wisata</label>
                        </div>
                        <div class="permission-item">
                            <input type="checkbox" class="permission-checkbox" id="permSettings" ${user.permissions.settings ? 'checked' : ''}>
                            <label for="permSettings">Pengaturan</label>
                        </div>
                        <div class="permission-item">
                            <input type="checkbox" class="permission-checkbox" id="permBackup" ${user.permissions.backup ? 'checked' : ''}>
                            <label for="permBackup">Backup Data</label>
                        </div>
                    </div>
                </div>
            `;

            const addUserModal = new bootstrap.Modal(document.getElementById('addUserModal'));
            addUserModal.show();
        }

        // Save user
        function saveUser() {
            const fullName = document.getElementById('userFullName').value;
            const username = document.getElementById('userUsername').value;
            const password = document.getElementById('userPassword').value;
            const role = document.getElementById('userRole').value;
            const status = document.getElementById('userStatus').checked ? 'active' : 'inactive';

            if (!fullName || !username || !role) {
                alert('Harap isi semua field yang diperlukan!');
                return;
            }

            // Get permissions
            const permissions = {
                dashboard: true, // Always true
                ticketSales: document.getElementById('permTicketSales')?.checked || false,
                generateTicket: document.getElementById('permGenerateTicket')?.checked || false,
                ticketList: document.getElementById('permTicketList')?.checked || false,
                reports: document.getElementById('permReports')?.checked || false,
                products: document.getElementById('permProducts')?.checked || false,
                settings: document.getElementById('permSettings')?.checked || false,
                backup: document.getElementById('permBackup')?.checked || false,
                restore: role === 'admin',
                reset: role === 'admin'
            };

            // Check if user exists (edit mode)
            const existingIndex = users.findIndex(u => u.username === username);
            
            const now = new Date();
            const lastLogin = now.toISOString().split('T')[0] + ' ' + now.toTimeString().split(' ')[0];
            
            const user = {
                fullName,
                username,
                password: existingIndex >= 0 && !password ? users[existingIndex].password : CryptoJS.SHA256(password).toString(),
                role,
                status,
                lastLogin,
                permissions
            };

            if (existingIndex >= 0) {
                // Update existing user
                if (!password) {
                    // Keep existing password if not changed
                    user.password = users[existingIndex].password;
                }
                users[existingIndex] = user;
                alert('Pengguna berhasil diperbarui!');
            } else {
                if (!password) {
                    alert('Password harus diisi untuk pengguna baru!');
                    return;
                }
                // Add new user
                users.push(user);
                alert('Pengguna berhasil ditambahkan!');
            }

            // Close modal and refresh list
            bootstrap.Modal.getInstance(document.getElementById('addUserModal')).hide();
            loadUsers();
        }

        // Delete user
        function deleteUser(username) {
            if (username === currentUser.username) {
                alert('Anda tidak dapat menghapus akun sendiri!');
                return;
            }

            if (confirm('Apakah Anda yakin ingin menghapus pengguna ini?')) {
                users = users.filter(u => u.username !== username);
                loadUsers();
                alert('Pengguna berhasil dihapus!');
            }
        }

        // Save settings
        function saveSettings() {
            const appName = document.getElementById('appName').value;
            const timezone = document.getElementById('timezone').value;
            const enableTax = document.getElementById('enableTax').checked;
            const taxRate = parseFloat(document.getElementById('taxRate').value) || 0;
            const receiptHeader = document.getElementById('receiptHeader').value;
            const receiptFooter = document.getElementById('receiptFooter').value;
            const printLogo = document.getElementById('printLogo').checked;
            const printAddress = document.getElementById('printAddress').checked;

            // Update receipt preview
            document.getElementById('previewReceiptTitle').textContent = appName;
            document.getElementById('previewReceiptFooter').textContent = receiptFooter;

            // In a real app, this would save to server/database
            alert('Pengaturan berhasil disimpan!');
        }

        // Backup data
        function backupData() {
            const backupData = {
                tickets,
                products,
                users,
                transactions,
                backupHistory,
                timestamp: new Date().toISOString()
            };

            const dataStr = JSON.stringify(backupData, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `TourTick-Backup-${new Date().toISOString().split('T')[0]}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();

            // Add to backup history
            const now = new Date();
            const backupDate = now.toISOString().split('T')[0] + ' ' + now.toTimeString().split(' ')[0];
            backupHistory.unshift({
                date: backupDate,
                type: 'manual',
                size: formatBytes(new Blob([dataStr]).size),
                by: currentUser.fullName
            });

            loadBackupHistory();
            alert('Backup data berhasil!');
        }

        // Format bytes to human readable format
        function formatBytes(bytes, decimals = 2) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const dm = decimals < 0 ? 0 : decimals;
            const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(dm)) + ' ' + sizes[i];
        }

        // Show restore modal
        function showRestoreModal() {
            if (currentUser.role !== 'admin') {
                alert('Hanya admin yang dapat melakukan restore data!');
                return;
            }
            
            document.getElementById('restoreFile').value = '';
            document.getElementById('adminPassword').value = '';
            const restoreModal = new bootstrap.Modal(document.getElementById('restoreModal'));
            restoreModal.show();
        }

        // Restore data
        function restoreData() {
            const fileInput = document.getElementById('restoreFile');
            const adminPassword = document.getElementById('adminPassword').value;
            
            if (!fileInput.files.length) {
                alert('Pilih file backup terlebih dahulu!');
                return;
            }

            if (!adminPassword) {
                alert('Masukkan password admin!');
                return;
            }

            // Verify admin password
            const admin = users.find(u => u.role === 'admin');
            if (!admin || admin.password !== CryptoJS.SHA256(adminPassword).toString()) {
                alert('Password admin salah!');
                return;
            }

            const file = fileInput.files[0];
            const reader = new FileReader();

            reader.onload = function(e) {
                try {
                    const backupData = JSON.parse(e.target.result);
                    
                    // Validate backup data
                    if (!backupData.tickets || !backupData.products || !backupData.users || !backupData.transactions) {
                        throw new Error('Format file backup tidak valid');
                    }

                    // Restore data
                    tickets = backupData.tickets;
                    products = backupData.products;
                    users = backupData.users;
                    transactions = backupData.transactions;
                    backupHistory = backupData.backupHistory || [];

                    // Add restore entry to backup history
                    const now = new Date();
                    const restoreDate = now.toISOString().split('T')[0] + ' ' + now.toTimeString().split(' ')[0];
                    backupHistory.unshift({
                        date: restoreDate,
                        type: 'restore',
                        size: formatBytes(file.size),
                        by: currentUser.fullName
                    });

                    // Close modal
                    bootstrap.Modal.getInstance(document.getElementById('restoreModal')).hide();

                    // Refresh UI
                    refreshDashboard();
                    loadBackupHistory();
                    alert('Data berhasil di-restore!');
                } catch (error) {
                    alert('Gagal memproses file backup: ' + error.message);
                }
            };

            reader.readAsText(file);
        }

        // Show reset confirmation
        function showResetConfirmation() {
            if (currentUser.role !== 'admin') {
                alert('Hanya admin yang dapat melakukan reset data!');
                return;
            }
            
            document.getElementById('resetAdminPassword').value = '';
            const resetModal = new bootstrap.Modal(document.getElementById('resetConfirmationModal'));
            resetModal.show();
        }

        // Reset data
        function resetData() {
            const adminPassword = document.getElementById('resetAdminPassword').value;
            
            if (!adminPassword) {
                alert('Masukkan password admin!');
                return;
            }

            // Verify admin password
            const admin = users.find(u => u.role === 'admin');
            if (!admin || admin.password !== CryptoJS.SHA256(adminPassword).toString()) {
                alert('Password admin salah!');
                return;
            }

            if (confirm('Apakah Anda YAKIN ingin mereset semua data? Tindakan ini tidak dapat dibatalkan!')) {
                // Create backup before reset
                const backupData = {
                    tickets,
                    products,
                    users,
                    transactions,
                    backupHistory,
                    timestamp: new Date().toISOString()
                };
                const dataStr = JSON.stringify(backupData, null, 2);
                
                // Reset data to initial state
                tickets = [];
                products = [];
                transactions = [];
                
                // Keep only admin user
                users = users.filter(u => u.role === 'admin');
                
                // Add reset entry to backup history
                const now = new Date();
                const resetDate = now.toISOString().split('T')[0] + ' ' + now.toTimeString().split(' ')[0];
                backupHistory.unshift({
                    date: resetDate,
                    type: 'reset',
                    size: formatBytes(new Blob([dataStr]).size),
                    by: currentUser.fullName
                });

                // Close modal
                bootstrap.Modal.getInstance(document.getElementById('resetConfirmationModal')).hide();

                // Refresh UI
                refreshDashboard();
                loadBackupHistory();
                alert('Data berhasil direset ke kondisi awal!');
            }
        }

        // Load backup history
        function loadBackupHistory() {
            const backupHistoryTable = document.getElementById('backupHistoryTable');
            
            backupHistoryTable.innerHTML = backupHistory.map(backup => `
                <tr>
                    <td>${backup.date}</td>
                    <td>${backup.type === 'manual' ? 'Manual' : 
                         backup.type === 'automatic' ? 'Otomatis' : 
                         backup.type === 'restore' ? 'Restore' : 'Reset'}</td>
                    <td>${backup.size}</td>
                    <td>${backup.by}</td>
                    <td>
                        ${backup.type === 'restore' || backup.type === 'reset' ? 'N/A' : `
                            <button class="btn btn-sm btn-primary" onclick="downloadBackup('${backup.date}')">
                                <i class="fas fa-download"></i> Unduh
                            </button>
                        `}
                    </td>
                </tr>
            `).join('');
        }

        // Download specific backup (simulated)
        function downloadBackup(backupDate) {
            const backup = backupHistory.find(b => b.date === backupDate);
            if (!backup) return;
            
            // In a real app, this would fetch the actual backup file
            alert(`Fitur download backup spesifik akan mengunduh backup dari ${backupDate}`);
        }
    </script>
</body>
</html>
